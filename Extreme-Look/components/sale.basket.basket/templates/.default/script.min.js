function updateBasketTable(t,e){var a,s,i,r,l,n,o,u,c,_,d,p,T,A,I,m,B,E,S,y,P,X,N,b,U,h,D,k,v,R,C,Q,O,f,M,g,L,Y,F,x,V,q,w,J,j,K,H,W,G=BX("basket_items"),z=!1,$=!1,Z=!1,tt=!1,et=!1,at=getColumnName(e,"PROPERTY_ARTNUMBER_VALUE"),st=!1,it=getColumnName(e,"PROPERTY_OBJECT_VALUE"),rt=!1;if(G&&"object"==typeof e){if(r=(a=G.querySelectorAll('[data-entity="row"]'))[a.length-1],_="Y"===e.PARAMS.QUANTITY_FLOAT,null!==t&&e.BASKET_DATA&&(d=BX(t),s=e.BASKET_ID,(W=BX.type.isPlainObject(e.BASKET_DATA.GRID.ROWS[s]))&&(i=e.BASKET_DATA.GRID.ROWS[s],(l=BX.create("DIV",{props:{className:"basket-item-tr"},attrs:{"data-entity":"row"}})).setAttribute("id",e.BASKET_ID),l.setAttribute("data-item-name",i.NAME),l.setAttribute("data-item-brand",i[basketJSParams.BRAND_PROPERTY+"_VALUE"]),l.setAttribute("data-item-price",i.PRICE),l.setAttribute("data-item-currency",i.CURRENCY),l.setAttribute("data-item-measure",null!=i.MEASURE_SYMBOL_INTL?i.MEASURE_SYMBOL_INTL:""),r.parentNode.insertBefore(l,d.nextSibling)),"Y"===e.DELETE_ORIGINAL&&(d.parentNode.removeChild(d),W||BX.onCustomEvent("OnBasketChange")),W)){for(l.appendChild(BX.create("DIV",{props:{className:"hidden-xs basket-item-td basket-item-sep"}})),n=e.COLUMNS.split(","),p=0;p<n.length;p++)"DELETE"===n[p]?z=!0:"DELAY"===n[p]?$=!0:"PROPS"===n[p]?Z=!0:"TYPE"===n[p]?tt=!0:"PROPERTY_ARTNUMBER_VALUE"===n[p]?(et=!0,o=n[p]):"PROPERTY_OBJECT_VALUE"===n[p]?(st=!0,u=n[p]):"PROPERTY_M2_COUNT_VALUE"===n[p]&&(rt=!0,c=n[p]);for(p=0;p<n.length;p++)switch(n[p]){case"PROPS":case"DELAY":case"DELETE":case"TYPE":case"PROPERTY_ARTNUMBER_VALUE":case"PROPERTY_OBJECT_VALUE":case"PROPERTY_M2_COUNT_VALUE":case"PROPERTY_OLD_PRICE_VALUE":break;case"NAME":if(A="",i.PREVIEW_PICTURE_SRC.length>0?T=i.PREVIEW_PICTURE_SRC:i.DETAIL_PICTURE_SRC.length>0&&(T=i.DETAIL_PICTURE_SRC),A='<div class="basket-item-image-container"><div class="basket-item-image'+(T.length>0?"":" basket-item-image-empty")+'">',T.length>0&&(A+='<img src="'+T+'" alt="'+i.NAME+'" />'),A+="</div></div>",A+='<div class="basket-item-info"><div class="basket-item-title">',et&&(A+='<span class="basket-item-article">',A+='<span id="col_'+o+'">'+at+"</span>: ",A+=(i[o]?i[o]:"-")+"</span>"),st&&i.PROPERTY_OBJECT_FULL_VALUE&&(A+='<span class="basket-item-object">',A+='<span id="col_'+u+'">'+it+"</span>: ",A+=i.PROPERTY_OBJECT_FULL_VALUE.NAME+"</span>"),i.DETAIL_PAGE_URL.length>0&&(A+='<a href="'+i.DETAIL_PAGE_URL+'">'),A+=i.NAME,i.DETAIL_PAGE_URL.length>0&&(A+="</a>"),Z)for(m=0;m<i.PROPS.length;m++){if(B=i.PROPS[m],i.SKU_DATA){for(E in I=!1,i.SKU_DATA)if(i.SKU_DATA.hasOwnProperty(E)&&(S=i.SKU_DATA[E]).CODE===B.CODE){I=!0;break}if(I)continue}A+='<span class="basket-item-prop">'+BX.util.htmlspecialchars(B.NAME)+": "+B.VALUE+"</span>"}if(i.SKU_DATA){for(j={},U=0;U<i.PROPS.length;U++)j[(h=i.PROPS[U]).CODE]=BX.type.isNotEmptyString(h["~VALUE"])?h["~VALUE"]:h.VALUE;for(E in i.SKU_DATA)if(i.SKU_DATA.hasOwnProperty(E)){for(P in K=0,H=0,(S=i.SKU_DATA[E]).VALUES)H++,y=S.VALUES[P],BX.type.isNotEmptyString(j[S.CODE])&&(j[S.CODE]!=y.NAME&&j[S.CODE]!=y.XML_ID||(K=H));for(b in A+='<div class="basket-item-sku-prop">',A+='<div class="basket-item-sku-title">'+BX.util.htmlspecialchars(S.NAME)+"</div>",A+='<ul class="basket-item-sku-list" id="prop_'+S.CODE+"_"+i.ID+'">',H=0,S.VALUES)N=K==++H?" selected":"",(X=S.VALUES[b]).CODE&&X.CODE.length>0||X.PICT?(style=X.CODE&&X.CODE.length>0?" background-color: #"+X.CODE+";":X.PICT?" background-image: url("+X.PICT.SRC+");":"",A+='<li class="basket-item-sku-item-color'+N+'" \t\t\t\t\t\t\t\t\t\t\t\tdata-sku-selector="Y" \t\t\t\t\t\t\t\t\t\t\t\tdata-value-id="'+X.XML_ID+'" \t\t\t\t\t\t\t\t\t\t\t\tdata-sku-name="'+BX.util.htmlspecialchars(X.NAME)+'" \t\t\t\t\t\t\t\t\t\t\t\tdata-element="'+i.ID+'" \t\t\t\t\t\t\t\t\t\t\t\tdata-property="'+S.CODE+'" \t\t\t\t\t\t\t\t\t\t\t\tstyle="'+style+'"></li>'):A+='<li class="basket-item-sku-item-text'+N+'" \t\t\t\t\t\t\t\t\t\t\t\tdata-sku-selector="Y" \t\t\t\t\t\t\t\t\t\t\t\tdata-value-id="'+("S"===S.TYPE&&"directory"===S.USER_TYPE?X.XML_ID:BX.util.htmlspecialchars(X.NAME))+'" \t\t\t\t\t\t\t\t\t\t\t\tdata-sku-name="'+BX.util.htmlspecialchars(X.NAME)+'" \t\t\t\t\t\t\t\t\t\t\t\tdata-element="'+i.ID+'" \t\t\t\t\t\t\t\t\t\t\t\tdata-property="'+S.CODE+'">'+BX.util.htmlspecialchars(X.NAME)+"</li>";A+="</ul></div>"}}l.appendChild(BX.create("DIV",{props:{className:"basket-item-td basket-item-item"},html:A}));break;case"QUANTITY":D="",rt&&i[c]&&("pc. 1"==i.MEASURE_SYMBOL_INTL||"m2"==i.MEASURE_SYMBOL_INTL)?(R=!1,O=i.PC_QUANTITY,i.PC_QUANTITY=getCorrectRatioQuantity(i.PC_QUANTITY,i.PC_MEASURE_RATIO,!1),O!=i.PC_QUANTITY&&(R=!0),C=!1,f=i.SQ_M_QUANTITY,i.SQ_M_QUANTITY=getCorrectRatioQuantity(i.SQ_M_QUANTITY,i.SQ_M_MEASURE_RATIO,!0),f!=i.SQ_M_QUANTITY&&(C=!0),D+='<div class="basket-item-amount">',D+='<a class="basket-item-amount-btn-minus" href="javascript:void(0)" onclick="setQuantity(\'PC_QUANTITY_INPUT_'+i.ID+"', "+i.ID+", "+i.PC_MEASURE_RATIO+", 'down', false);\">-</a>",D+='<input type="text" class="basket-item-amount-input" id="PC_QUANTITY_INPUT_'+i.ID+'" \t\t\t\t\t\t\t\tname="PC_QUANTITY_INPUT_'+i.ID+'" \t\t\t\t\t\t\t\tmaxlength="18" \t\t\t\t\t\t\t\tvalue="'+i.PC_QUANTITY+'" \t\t\t\t\t\t\t\tonchange="updatePcQuantity(\'PC_QUANTITY_INPUT_'+i.ID+"', "+i.ID+", "+i.PC_MEASURE_RATIO+', false);" \t\t\t\t\t\t\t\tdata-ratio="'+i.PC_MEASURE_RATIO+'" \t\t\t\t\t\t\t\t/>',D+='<a class="basket-item-amount-btn-plus" href="javascript:void(0)" onclick="setQuantity(\'PC_QUANTITY_INPUT_'+i.ID+"', "+i.ID+", "+i.PC_MEASURE_RATIO+", 'up', false);\">+</a>",D+='<div class="basket-item-amount-measure">'+BX.message("MEASURE_PC")+"</div>",D+="</div>",D+='<div class="basket-item-amount">',D+='<a class="basket-item-amount-btn-minus" href="javascript:void(0)" onclick="setQuantity(\'SQ_M_QUANTITY_INPUT_'+i.ID+"', "+i.ID+", "+i.SQ_M_MEASURE_RATIO+", 'down', true);\">-</a>",D+='<input type="text" class="basket-item-amount-input" id="SQ_M_QUANTITY_INPUT_'+i.ID+'" \t\t\t\t\t\t\t\tname="SQ_M_QUANTITY_INPUT_'+i.ID+'" \t\t\t\t\t\t\t\tmaxlength="18" \t\t\t\t\t\t\t\tvalue="'+i.SQ_M_QUANTITY+'" \t\t\t\t\t\t\t\tonchange="updateSqMQuantity(\'SQ_M_QUANTITY_INPUT_'+i.ID+"', "+i.ID+", "+i.SQ_M_MEASURE_RATIO+', true);" \t\t\t\t\t\t\t\tdata-ratio="'+i.SQ_M_MEASURE_RATIO+'" \t\t\t\t\t\t\t\t/>',D+='<a class="basket-item-amount-btn-plus" href="javascript:void(0)" onclick="setQuantity(\'SQ_M_QUANTITY_INPUT_'+i.ID+"', "+i.ID+", "+i.SQ_M_MEASURE_RATIO+", 'up', true);\">+</a>",D+='<div class="basket-item-amount-measure">'+BX.message("MEASURE_SQ_M")+"</div>",D+="</div>"):(v=!1,0!=(k=parseFloat(i.MEASURE_RATIO)>0?i.MEASURE_RATIO:1)&&""!=k&&(Q=i.QUANTITY,i.QUANTITY=getCorrectRatioQuantity(i.QUANTITY,k,_),Q!=i.QUANTITY&&(v=!0)),D+='<div class="basket-item-amount">',0!=k&&""!=k&&(D+='<a class="basket-item-amount-btn-minus" href="javascript:void(0)" onclick="setQuantity(\'QUANTITY_INPUT_'+i.ID+"', "+i.ID+", "+i.MEASURE_RATIO+", 'down', "+_+');">-</a>'),D+='<input type="text" class="basket-item-amount-input" id="QUANTITY_INPUT_'+i.ID+'" \t\t\t\t\t\t\t\tname="QUANTITY_INPUT_'+i.ID+'" \t\t\t\t\t\t\t\tmaxlength="18" \t\t\t\t\t\t\t\tvalue="'+i.QUANTITY+'" \t\t\t\t\t\t\t\tonchange="updateQuantity(\'QUANTITY_INPUT_'+i.ID+"', "+i.ID+", "+k+", "+_+')" \t\t\t\t\t\t\t\t/>',0!=k&&""!=k&&(D+='<a class="basket-item-amount-btn-plus" href="javascript:void(0)" onclick="setQuantity(\'QUANTITY_INPUT_'+i.ID+"', "+i.ID+", "+i.MEASURE_RATIO+", 'up', "+_+');">+</a>'),i.hasOwnProperty("MEASURE_TEXT")&&i.MEASURE_TEXT.length>0&&(D+='<div class="basket-item-amount-measure">'+BX.util.htmlspecialchars(i.MEASURE_TEXT)+"</div>"),D+="</div>"),D+='<input type="hidden" id="QUANTITY_'+i.ID+'" name="QUANTITY_'+i.ID+'" value="'+i.QUANTITY+'" />',l.appendChild(BX.create("DIV",{props:{className:"basket-item-td"},html:D})),v&&updateQuantity("QUANTITY_INPUT_"+i.ID,i.ID,k,_),R?updatePcQuantity("PC_QUANTITY_INPUT_"+i.ID,i.ID,i.PC_MEASURE_RATIO,!1):C&&updateSqMQuantity("SQ_M_QUANTITY_INPUT_"+i.ID,i.ID,i.SQ_M_MEASURE_RATIO,!0);break;case"PRICE":M="",g=i.DISCOUNT_PRICE_PERCENT>0?i.SQ_M_FULL_PRICE?i.SQ_M_FULL_PRICE_FORMATED:i.FULL_PRICE_FORMATED:"",M+='<div id="current_price_'+i.ID+'"><span data-entity="price-current">'+(i.SQ_M_PRICE?i.SQ_M_PRICE_FORMATED:i.PRICE_FORMATED)+"</span>",rt&&i[c]&&("pc. 1"==i.MEASURE_SYMBOL_INTL||"m2"==i.MEASURE_SYMBOL_INTL)&&(M+="<span>/"+BX.message("MEASURE_SQ_M")+"</span>"),M+="</div>",M+='<div class="basket-item-old-price" id="old_price_'+i.ID+'">'+g+"</div>",tt&&i.NOTES.length>0&&(M+='<div class="basket-item-type-price">'+basketJSParams.SALE_TYPE+"</div>",M+='<div class="basket-item-type-price-value">'+i.NOTES+"</div>"),l.appendChild(BX.create("DIV",{props:{className:"hidden-xs basket-item-td"},html:M}));break;case"DISCOUNT":Y='<div id="discount_value_'+i.ID+'">'+i.DISCOUNT_PRICE_PERCENT_FORMATED+"</div>",l.appendChild(BX.create("DIV",{props:{className:"hidden-xs basket-item-td basket-item-discount-percent"},html:Y}));break;case"WEIGHT":l.appendChild(BX.create("DIV",{props:{className:"hidden-xs basket-item-td"},html:i.WEIGHT_FORMATED}));break;case"SUM":F='<div id="sum_'+i.ID+'">',void 0!==i[n[p]]&&(F+=i[n[p]]),F+="</div>",l.appendChild(BX.create("DIV",{props:{className:"basket-item-td basket-item-sum"},html:F}));break;default:x="",void 0!==i[n[p]]&&(x+=i[n[p]]),l.appendChild(BX.create("DIV",{props:{className:"hidden-xs basket-item-td"},html:x}))}z||!basketJSParams.DISABLE_DELAY&&$?(V="",!basketJSParams.DISABLE_DELAY&&$&&(V+='<a class="basket-item-control" \t\t\t\t\t\thref="'+basketJSParams.DELAY_URL.replace("#ID#",i.ID)+'" \t\t\t\t\t\ttitle="'+basketJSParams.SALE_DELAY+'">\t\t\t\t\t\t<i class="icon-star"></i></a>'),z&&(V+='<a class="basket-item-control" \t\t\t\t\t\thref="'+basketJSParams.DELETE_URL.replace("#ID#",i.ID)+'" \t\t\t\t\t\ttitle="'+basketJSParams.SALE_DELETE+'">\t\t\t\t\t\t<i class="icon-close"></i></a>'),l.appendChild(BX.create("DIV",{props:{className:"basket-item-td basket-item-sep"},style:{position:"relative"},children:[BX.create("DIV",{props:{className:"basket-item-controls"},html:V})]}))):l.appendChild(BX.create("DIV",{props:{className:"hidden-xs basket-item-td basket-item-sep"}})),q=BX(i.ID).querySelector(".basket-item-info"),J=!!(w=BX(i.ID).querySelector(".basket-item-controls"))&&w.querySelectorAll(".basket-item-control"),q&&J&&(window.innerWidth<992?BX.style(q,"padding-right",w.offsetWidth+"px"):BX.style(q,"padding-right",""))}if(e.BASKET_DATA)for(L in e.BASKET_DATA.GRID.ROWS)if(e.BASKET_DATA.GRID.ROWS.hasOwnProperty(L)){var lt=e.BASKET_DATA.GRID.ROWS[L];BX("discount_value_"+L)&&(BX("discount_value_"+L).innerHTML=lt.DISCOUNT_PRICE_PERCENT_FORMATED),BX("current_price_"+L)&&(BX("current_price_"+L).querySelector('[data-entity="price-current"]').innerHTML=lt.SQ_M_PRICE?lt.SQ_M_PRICE_FORMATED:lt.PRICE_FORMATED),BX("old_price_"+L)&&(BX("old_price_"+L).innerHTML=lt.DISCOUNT_PRICE_PERCENT>0?lt.SQ_M_FULL_PRICE?lt.SQ_M_FULL_PRICE_FORMATED:lt.FULL_PRICE_FORMATED:""),BX("sum_"+L)&&(BX("sum_"+L).innerHTML=lt.SUM),BX("QUANTITY_"+L)&&(BX("QUANTITY_INPUT_"+L)&&(BX("QUANTITY_INPUT_"+L).value=lt.QUANTITY,BX("QUANTITY_INPUT_"+L).defaultValue=lt.QUANTITY),BX("PC_QUANTITY_INPUT_"+L)&&BX("SQ_M_QUANTITY_INPUT_"+L)&&(BX("PC_QUANTITY_INPUT_"+L).value=lt.PC_QUANTITY,BX("PC_QUANTITY_INPUT_"+L).defaultValue=lt.PC_QUANTITY,BX("SQ_M_QUANTITY_INPUT_"+L).value=lt.SQ_M_QUANTITY,BX("SQ_M_QUANTITY_INPUT_"+L).defaultValue=lt.SQ_M_QUANTITY),BX("QUANTITY_"+L).value=lt.QUANTITY)}if(e.BASKET_DATA&&couponListUpdate(e.BASKET_DATA),e.BASKET_DATA){var nt=BX("warning_message"),ot=[];if(e.hasOwnProperty("WARNING_MESSAGE")){for(p=0;p<e.WARNING_MESSAGE.length;p++)ot[p]=e.WARNING_MESSAGE[p];nt.innerHTML='<span class="alert alert-warning alert-show">'+ot.join("<br />")+"</span>",nt.style.display="block"}else nt.innerHTML="",nt.style.display="none"}if(e.BASKET_DATA){BX("allWeight_FORMATED")&&(BX("allWeight_FORMATED").innerHTML=e.BASKET_DATA.allWeight_FORMATED),BX("allSum_wVAT_FORMATED")&&(BX("allSum_wVAT_FORMATED").innerHTML=e.BASKET_DATA.allSum_wVAT_FORMATED),BX("allVATSum_FORMATED")&&(BX("allVATSum_FORMATED").innerHTML=e.BASKET_DATA.allVATSum_FORMATED),BX("allSum_FORMATED")&&(BX("allSum_FORMATED").innerHTML=e.BASKET_DATA.allSum_FORMATED);var ut=e.BASKET_DATA.PRICE_WITHOUT_DISCOUNT!=e.BASKET_DATA.allSum_FORMATED;if(BX("PRICE_WITHOUT_DISCOUNT")&&(BX("PRICE_WITHOUT_DISCOUNT").innerHTML=ut?e.BASKET_DATA.PRICE_WITHOUT_DISCOUNT:"",BX.style(BX("PRICE_WITHOUT_DISCOUNT"),"display",ut?"block":"none")),BX("DISCOUNT_PRICE_ALL_FORMATED")&&(BX("DISCOUNT_PRICE_ALL_FORMATED").innerHTML=ut?basketJSParams.SALE_TOTAL_DISCOUNT+" "+e.BASKET_DATA.DISCOUNT_PRICE_ALL_FORMATED:"",BX.style(BX("DISCOUNT_PRICE_ALL_FORMATED"),"display",ut?"block":"none")),basketJSParams.MIN_ORDER_SUM>0){var ct=document.body.querySelector('[data-entity="quickOrder"]');if(ct)if(BX.unbindAll(ct),e.BASKET_DATA.allSum<parseFloat(basketJSParams.MIN_ORDER_SUM))BX.adjust(ct,{props:{disabled:!0}});else{BX.adjust(ct,{props:{disabled:!1}});var _t="true"==ct.getAttribute("data-has-object");BX.bind(ct,"click",function(t){quickOrder(t,_t)})}var dt=document.body.querySelector('[data-entity="checkOut"]');dt&&(BX.unbindAll(dt),e.BASKET_DATA.allSum<parseFloat(basketJSParams.MIN_ORDER_SUM)?BX.adjust(dt,{props:{disabled:!0}}):(BX.adjust(dt,{props:{disabled:!1}}),BX.bind(dt,"click",function(){checkOut()})))}BX.onCustomEvent("OnBasketTableChange")}}}function couponCreate(t,e){var a="disabled";BX.type.isElementNode(t)&&("BAD"===e.JS_STATUS?a="bad":"APPLYED"===e.JS_STATUS&&(a="good"),t.appendChild(BX.create("div",{props:{className:"bx_ordercart_coupon"},children:[BX.create("input",{props:{type:"hidden",name:"OLD_COUPON[]",value:e.COUPON}}),BX.create("span",{props:{className:"bx_ordercart_coupon_note "+a},html:e.COUPON+" "+e.JS_CHECK_CODE}),BX.create("span",{props:{className:"bx_ordercart_coupon_close_container"},children:[BX.create("span",{props:{className:"bx_ordercart_coupon_close"},attrs:{"data-coupon":e.COUPON}})]})]})))}function couponListUpdate(t){var e,a,s,i,r,l,n,o,u;if(!t||"object"==typeof t){if((e=BX("coupons_block"))&&t.COUPON_LIST&&BX.type.isArray(t.COUPON_LIST))if((s=BX("coupon"))&&(s.value=""),i=BX.findChildren(e,{tagName:"input",property:{name:"OLD_COUPON[]"}},!0)){for(BX.type.isElementNode(i)&&(i=[i]),n=0;n<t.COUPON_LIST.length;n++){for(r=!1,u=-1,o=0;o<i.length;o++)if(i[o].value===t.COUPON_LIST[n].COUPON){r=!0,u=o,i[o].couponUpdate=!0;break}r?(a="disabled","BAD"===t.COUPON_LIST[n].JS_STATUS?a="bad":"APPLYED"===t.COUPON_LIST[n].JS_STATUS&&(a="good"),(l=BX.findNextSibling(i[u],{className:"bx_ordercart_coupon_note"}))&&BX.adjust(l,{props:{className:"bx_ordercart_coupon_note "+a},html:t.COUPON_LIST[n].COUPON+" "+t.COUPON_LIST[n].JS_CHECK_CODE})):couponCreate(e,t.COUPON_LIST[n])}for(o=0;o<i.length;o++)void 0!==i[o].couponUpdate&&i[o].couponUpdate?i[o].couponUpdate=null:(BX.remove(i[o].parentNode),i[o]=null)}else for(n=0;n<t.COUPON_LIST.length;n++)couponCreate(e,t.COUPON_LIST[n]);e=null}}function skuPropClickHandler(){var t,e,a,s,i,r,l,n={},o={};if(this&&this.hasAttribute("data-value-id")){if(BX.showWait(),t=this.getAttribute("data-element"),e=this.getAttribute("data-property"),a=BX("action_var").value,n[e]=BX.util.htmlspecialcharsback(this.getAttribute("data-value-id")),BX.hasClass(this,"selected"))return void BX.closeWait();if((s=BX.findChildren(BX(t),{tagName:"ul",className:"basket-item-sku-list"},!0))&&s.length>0)for(i=0;s.length>i;i++)if(s[i].id!=="prop_"+e+"_"+t&&(r=BX.findChildren(BX(s[i].id),{tagName:"li",className:"selected"},!0))&&r.length>0)for(l=0;r.length>l;l++)r[l].hasAttribute("data-value-id")&&(n[r[l].getAttribute("data-property")]=BX.util.htmlspecialcharsback(r[l].getAttribute("data-value-id")));(o={basketItemId:t,sessid:BX.bitrix_sessid(),site_id:BX.message("SITE_ID"),props:n,action_var:a,select_props:BX("column_headers").value,offers_props:BX("offers_props").value,quantity_float:BX("quantity_float").value,price_vat_show_value:BX("price_vat_show_value").value,hide_coupon:BX("hide_coupon").value,use_prepayment:BX("use_prepayment").value,via_ajax:"Y",template:basketJSParams.SIGNED_TEMPLATE,signedParamsString:basketJSParams.SIGNED_PARAMS})[a]="select_item",BX.ajax({url:"/bitrix/components/altop/sale.basket.basket/ajax.php",method:"POST",data:o,dataType:"json",onsuccess:function(e){BX.closeWait(),updateBasketTable(t,e)}})}}function getColumnName(t,e){return BX("col_"+e)?BX.util.trim(BX("col_"+e).innerHTML):""}function checkOut(){return BX("coupon")&&(BX("coupon").disabled=!0),BX("basket_form").submit(),!0}function updateBasket(){recalcBasketAjax({})}function enterCoupon(){var t=BX("coupon");t&&t.value&&recalcBasketAjax({coupon:t.value})}function updateQuantity(t,e,a,s){var i=BX(t).defaultValue,r=parseFloat(BX(t).value)||0,l=!1,n=BX("auto_calculation")&&"Y"==BX("auto_calculation").value||!BX("auto_calculation");0===a||1==a?l=!0:0===1e4*r%(1e4*a)&&(l=!0);var o=!1;parseInt(r)!=parseFloat(r)&&(o=!0),r=correctQuantity(r=!1===s&&!1===o?parseInt(r):parseFloat(r).toFixed(4)),l?(BX(t).defaultValue=r,BX(t).value=r,BX("QUANTITY_"+e).value=r,n&&basketPoolQuantity.changeQuantity(e)):(r=correctQuantity(r=getCorrectRatioQuantity(r,a,s)))!=i?(BX(t).defaultValue=r,BX(t).value=r,BX("QUANTITY_"+e).value=r,n&&basketPoolQuantity.changeQuantity(e)):BX(t).value=i}function updatePcQuantity(t,e,a,s){var i=BX("basket_items").querySelector('[id="'+e+'"]'),r=!!i&&i.getAttribute("data-item-measure"),l=BX(t).defaultValue,n=parseFloat(BX(t).value)||0,o=!1,u=BX("auto_calculation")&&"Y"==BX("auto_calculation").value||!BX("auto_calculation"),c=!1;0===a||1==a?o=!0:0===1e4*n%(1e4*a)&&(o=!0);var _=!1;parseInt(n)!=parseFloat(n)&&(_=!0),n=correctQuantity(n=!1===s&&!1===_?parseInt(n):parseFloat(n).toFixed(4)),o?(BX(t).defaultValue=n,BX(t).value=n,r&&"pc. 1"==r&&(BX("QUANTITY_"+e).value=n,c=!0)):(n=correctQuantity(n=getCorrectRatioQuantity(n,a,s)))!=l?(BX(t).defaultValue=n,BX(t).value=n,r&&"pc. 1"==r&&(BX("QUANTITY_"+e).value=n,c=!0)):BX(t).value=l;var d=BX("SQ_M_QUANTITY_INPUT_"+e),p=d.defaultValue,T=parseFloat(d.getAttribute("data-ratio")),A=parseFloat(BX(t).value*T/a)||0,I=!1;0===T||1==T?I=!0:0===1e4*A%(1e4*T)&&(I=!0);parseInt(A),parseFloat(A),A=correctQuantity(A=parseFloat(A).toFixed(4)),I?(d.defaultValue=A,d.value=A,r&&"m2"==r&&(BX("QUANTITY_"+e).value=A,c=!0)):(A=correctQuantity(A=getCorrectRatioQuantity(A,T,!0)))!=p?(d.defaultValue=A,d.value=A,r&&"m2"==r&&(BX("QUANTITY_"+e).value=A,c=!0)):d.value=p,u&&c&&basketPoolQuantity.changeQuantity(e)}function updateSqMQuantity(t,e,a,s){var i=BX("basket_items").querySelector('[id="'+e+'"]'),r=!!i&&i.getAttribute("data-item-measure"),l=BX(t).defaultValue,n=parseFloat(BX(t).value)||0,o=!1,u=BX("auto_calculation")&&"Y"==BX("auto_calculation").value||!BX("auto_calculation"),c=!1;0===a||1==a?o=!0:0===1e4*n%(1e4*a)&&(o=!0);var _=!1;parseInt(n)!=parseFloat(n)&&(_=!0),n=correctQuantity(n=!1===s&&!1===_?parseInt(n):parseFloat(n).toFixed(4)),o?(BX(t).defaultValue=n,BX(t).value=n,r&&"m2"==r&&(BX("QUANTITY_"+e).value=n,c=!0)):(n=correctQuantity(n=getCorrectRatioQuantity(n,a,s)))!=l?(BX(t).defaultValue=n,BX(t).value=n,r&&"m2"==r&&(BX("QUANTITY_"+e).value=n,c=!0)):BX(t).value=l;var d=BX("PC_QUANTITY_INPUT_"+e),p=d.defaultValue,T=parseFloat(d.getAttribute("data-ratio")),A=parseFloat(BX(t).value*T/a)||0,I=!1;0===T||1==T?I=!0:0===1e4*A%(1e4*T)&&(I=!0);parseInt(A),parseFloat(A),A=correctQuantity(A=!1===_?parseInt(A):parseFloat(A).toFixed(4)),I?(d.defaultValue=A,d.value=A,r&&"pc. 1"==r&&(BX("QUANTITY_"+e).value=A,c=!0)):(A=correctQuantity(A=getCorrectRatioQuantity(A,T,!1)))!=p?(d.defaultValue=A,d.value=A,r&&"pc. 1"==r&&(BX("QUANTITY_"+e).value=A,c=!0)):d.value=p,u&&c&&basketPoolQuantity.changeQuantity(e)}function setQuantity(t,e,a,s,i){var r,l=parseFloat(BX(t).value);if(BX(t).defaultValue=l,(r="up"==s?l+a:l-a)<0&&(r=0),i&&(r=parseFloat(r).toFixed(4)),r=correctQuantity(r),a>0&&r<a&&(r=a),i||r==r.toFixed(4)||(r=parseFloat(r).toFixed(4)),r=correctQuantity(r=getCorrectRatioQuantity(r,a,i)),BX(t).value=r,t=="PC_QUANTITY_INPUT_"+e){var n,o=BX("SQ_M_QUANTITY_INPUT_"+e),u=parseFloat(o.value),c=parseFloat(o.getAttribute("data-ratio"));o.defaultValue=u,(n="up"==s?u+c:u-c)<0&&(n=0),n=correctQuantity(n=parseFloat(n).toFixed(4)),c>0&&n<c&&(n=c),n=correctQuantity(n=getCorrectRatioQuantity(n,c,!0)),o.value=n,updatePcQuantity(t,e,a,i)}else if(t=="SQ_M_QUANTITY_INPUT_"+e){var _,d=BX("PC_QUANTITY_INPUT_"+e),p=parseFloat(d.value),T=parseFloat(d.getAttribute("data-ratio"));d.defaultValue=p,(_="up"==s?p+T:p-T)<0&&(_=0),_=correctQuantity(_),T>0&&_<T&&(_=T),_!=_.toFixed(4)&&(_=parseFloat(_).toFixed(4)),_=correctQuantity(_=getCorrectRatioQuantity(_,T,!1)),d.value=_,updateSqMQuantity(t,e,a,i)}else updateQuantity(t,e,a,i)}function getCorrectRatioQuantity(t,e,a){var s,i=(t/e-(t/e).toFixed(0)).toFixed(6),r=t,l=!1;if(e=parseFloat(e),0==i)return r;if(0!==e&&1!=e)for(s=e,max=parseFloat(t)+parseFloat(e);s<=max;s=parseFloat(parseFloat(s)+parseFloat(e)).toFixed(4))r=s;else 1===e&&(r=0|t);return parseInt(r,10)!=parseFloat(r)&&(l=!0),r=correctQuantity(r=!1===a&&!1===l?parseInt(r,10):parseFloat(r).toFixed(4))}function correctQuantity(t){return parseFloat((1*t).toString())}function recalcBasketAjax(t){if(basketPoolQuantity.isProcessing())return!1;BX.showWait();var e,a,s=BX("action_var").value,i=BX("basket_items")&&BX("basket_items").querySelectorAll('[data-entity="row"]'),r=BX("delayed_items")&&BX("delayed_items").querySelectorAll('[data-entity="row"]');if((e={sessid:BX.bitrix_sessid(),site_id:BX.message("SITE_ID"),props:{},action_var:s,select_props:BX("column_headers").value,offers_props:BX("offers_props").value,quantity_float:BX("quantity_float").value,price_vat_show_value:BX("price_vat_show_value").value,hide_coupon:BX("hide_coupon").value,use_prepayment:BX("use_prepayment").value,via_ajax:"Y",template:basketJSParams.SIGNED_TEMPLATE,signedParamsString:basketJSParams.SIGNED_PARAMS})[s]="recalculate",t&&"object"==typeof t)for(a in t)t.hasOwnProperty(a)&&(e[a]=t[a]);if(i&&i.length>0)for(a=0;i.length>a;a++)e["QUANTITY_"+i[a].id]=BX("QUANTITY_"+i[a].id).value;if(r&&r.length>0)for(a=0;r.length>a;a++)e["DELAY_"+r[a].id]="Y";basketPoolQuantity.setProcessing(!0),basketPoolQuantity.clearPool(),BX.ajax({url:"/bitrix/components/altop/sale.basket.basket/ajax.php",method:"POST",data:e,dataType:"json",onsuccess:function(e){BX.closeWait(),basketPoolQuantity.setProcessing(!1),t.coupon&&e&&e.BASKET_DATA&&e.BASKET_DATA.NEED_TO_RELOAD_FOR_GETTING_GIFTS&&BX.reload(),basketPoolQuantity.isPoolEmpty()?(updateBasketTable(null,e),basketPoolQuantity.updateQuantity()):basketPoolQuantity.enableTimer(!0)}})}function showBasketItemsList(t){var e=document.body.querySelector('[data-entity="tabs"]'),a=e&&e.querySelectorAll('[data-entity="tab"]'),s=e&&e.querySelector('[data-value="basket-items"]'),i=e&&e.querySelector('[data-value="basket-items-delayed"]'),r=e&&e.querySelector('[data-entity="print"]'),l=e&&e.querySelector('[data-entity="clear"]'),n=e&&e.querySelector('[data-entity="clearDelay"]'),o=BX("basket_items_list"),u=BX("basket_items"),c=BX("basket_items_delayed"),_=BX("delayed_items");if(a)for(var d in a)a.hasOwnProperty(d)&&BX.removeClass(a[d],"active");2==t?(i&&BX.addClass(i,"active"),l&&BX.style(l,"display","none"),_?(r&&BX.style(r,"display","flex"),n&&BX.style(n,"display","flex")):(r&&BX.style(r,"display","none"),n&&BX.style(n,"display","none")),o&&(o.style.display="none"),c&&(c.style.display="block"),_&&checkBasketDelayItemInfoPadding(_)):(s&&BX.addClass(s,"active"),n&&BX.style(n,"display","none"),u?(r&&BX.style(r,"display","flex"),l&&BX.style(l,"display","flex")):(r&&BX.style(r,"display","none"),l&&BX.style(l,"display","none")),o&&(o.style.display="block"),c&&(c.style.display="none"),u&&checkBasketDelayItemInfoPadding(u))}function checkBasketDelayItemInfoPadding(t){if(!BX.isNodeHidden(t)){var e=t.querySelectorAll('[data-entity="row"]');if(e&&e.length>0)for(var a=0;e.length>a;a++){var s=e[a].querySelector(".basket-item-info"),i=e[a].querySelector(".basket-item-controls"),r=!!i&&i.querySelectorAll(".basket-item-control");s&&r&&(window.innerWidth<992?BX.style(s,"padding-right",i.offsetWidth+"px"):BX.style(s,"padding-right",""))}}}function deleteCoupon(){var t;this&&this.hasAttribute("data-coupon")&&(t=this.getAttribute("data-coupon"))&&t.length>0&&recalcBasketAjax({delete_coupon:t})}function deleteProductRow(t){var e,a,s=BX.findParent(t,{className:"basket-item-tr"});return s&&(e=BX("QUANTITY_"+s.id))&&(a=getCurrentItemAnalyticsInfo(s,e.value)),setAnalyticsDataLayer([],[a]),document.location.href=t.href,!1}function quickOrderRequest(t,e,a){BX.ajax({url:basketJSParams.SITE_DIR+"ajax/slide_panel.php",method:"POST",dataType:"json",timeout:60,data:{action:t?"quick_order_objects":"quick_order"},onsuccess:BX.delegate(function(t){t.content&&t.JS?BX.ajax.processScripts(BX.processHTML(t.JS).SCRIPT,!1,BX.delegate(function(){var s=BX.processHTML(t.content),i=BX.create("DIV");i.innerHTML=s.HTML;var r=e.querySelector(".slide-panel__title"),l=i.querySelector(".quick-order-form-title");l&&(r.innerHTML=l.innerHTML,BX.remove(l)),a.innerHTML=i.innerHTML,BX.ajax.processScripts(s.SCRIPT)},this)):(BX.cleanNode(a),a.appendChild(BX.create("DIV",{props:{className:"slide-panel__form"},children:[BX.create("DIV",{props:{className:"alert alert-error alert-show"},html:BX.message("SLIDE_PANEL_UNDEFINED_ERROR")})]}))),$(a).scrollbar()},this)})}function quickOrder(t,e){var a=document.querySelector(".slide-panel");if(a){a.appendChild(BX.create("DIV",{props:{className:"slide-panel__title-wrap"},children:[BX.create("I",{props:{className:"icon-bolt"}}),BX.create("SPAN",{props:{className:"slide-panel__title"}}),BX.create("SPAN",{props:{className:"slide-panel__close"},children:[BX.create("I",{props:{className:"icon-close"}})]})]})),a.appendChild(BX.create("DIV",{props:{className:"slide-panel__content scrollbar-inner"},children:[BX.create("DIV",{props:{className:"slide-panel__loader"},html:"<div><span></span></div>"})]}));var s=a.querySelector(".slide-panel__content");s&&BX.onCustomEvent("quickOrderRequest",[e,a,s]);var i=window.innerWidth-document.body.clientWidth;if(i>0){BX.style(document.body,"padding-right",i+"px");var r=document.querySelector(".page-bg");r&&BX.style(r,"margin-right",i+"px");var l=document.querySelector(".top-panel");if(l){BX.hasClass(l,"fixed")&&BX.style(l,"padding-right",i+"px");var n=l.querySelector(".top-panel__thead");n&&BX.hasClass(n,"fixed")&&BX.style(n,"padding-right",i+"px");var o=l.querySelector(".top-panel__tfoot");o&&BX.hasClass(o,"fixed")&&BX.style(o,"padding-right",i+"px")}}var u=BX.GetWindowScrollPos().scrollTop;u&&u>0&&BX.style(document.body,"top","-"+u+"px"),BX.addClass(document.body,"slide-panel-active"),BX.addClass(a,"active"),document.body.appendChild(BX.create("DIV",{props:{className:"modal-backdrop slide-panel__backdrop fadeInBig"}})),t.stopPropagation()}}function checkAnalytics(t,e){if(t&&e&&0!==BX.util.array_values(t).length){var a,s,i,r={},l=[],n=[];if(e&&e.length)for(i=0;e.length>i;i++)a=e[i].id,0!=(s=BX("QUANTITY_"+a).value-t[a])&&(r=getCurrentItemAnalyticsInfo(e[i],s),s>0?l.push(r):n.push(r));(l.length||n.length)&&setAnalyticsDataLayer(l,n)}}function getCurrentItemAnalyticsInfo(t,e){if(t){var a,s,i=[],r={name:t.getAttribute("data-item-name")||"",id:t.id,price:t.getAttribute("data-item-price")||0,brand:(t.getAttribute("data-item-brand")||"").split(",  ").join("/"),variant:"",quantity:Math.abs(e)};for(a=t.querySelectorAll(".selected[data-sku-name]"),s=0;s<a.length;s++)i.push(a[s].getAttribute("data-sku-name"));return r.variant=i.join("/"),r}}function setAnalyticsDataLayer(t,e){window[basketJSParams.DATA_LAYER_NAME]=window[basketJSParams.DATA_LAYER_NAME]||[],t&&t.length&&window[basketJSParams.DATA_LAYER_NAME].push({event:"addToCart",ecommerce:{currencyCode:getCurrencyCode(),add:{products:t}}}),e&&e.length&&window[basketJSParams.DATA_LAYER_NAME].push({event:"removeFromCart",ecommerce:{currencyCode:getCurrencyCode(),remove:{products:e}}})}function getCurrencyCode(){var t,e=BX("basket_items"),a="";return e&&(t=e.querySelector("[data-item-currency"))&&(a=t.getAttribute("data-item-currency")),a}BasketPoolQuantity=function(){this.processing=!1,this.poolQuantity={},this.updateTimer=null,this.currentQuantity={},this.lastStableQuantities={},this.updateQuantity()},BasketPoolQuantity.prototype.updateQuantity=function(){var t=BX("basket_items")&&BX("basket_items").querySelectorAll('[data-entity="row"]');if("Y"===basketJSParams.USE_ENHANCED_ECOMMERCE&&checkAnalytics(this.lastStableQuantities,t),t&&t.length>0)for(var e=0;t.length>e;e++){var a=t[e].id;this.currentQuantity[a]=BX("QUANTITY_"+a).value}this.lastStableQuantities=BX.clone(this.currentQuantity,!0)},BasketPoolQuantity.prototype.changeQuantity=function(t){var e=BX("QUANTITY_"+t).value,a=this.isPoolEmpty();this.currentQuantity[t]&&this.currentQuantity[t]!=e&&(this.poolQuantity[t]=this.currentQuantity[t]=e),a?this.trySendPool():this.enableTimer(!0)},BasketPoolQuantity.prototype.trySendPool=function(){this.isPoolEmpty()||this.isProcessing()||(this.enableTimer(!1),recalcBasketAjax({}))},BasketPoolQuantity.prototype.isPoolEmpty=function(){return 0==Object.keys(this.poolQuantity).length},BasketPoolQuantity.prototype.clearPool=function(){this.poolQuantity={}},BasketPoolQuantity.prototype.isProcessing=function(){return!0===this.processing},BasketPoolQuantity.prototype.setProcessing=function(t){this.processing=!0===t},BasketPoolQuantity.prototype.enableTimer=function(t){clearTimeout(this.updateTimer),!1!==t&&(this.updateTimer=setTimeout(function(){basketPoolQuantity.trySendPool()},1500))},BX.ready(function(){basketJSParams.DISABLE_DELAY||"?delay=Y"!=window.location.search||showBasketItemsList(2),basketPoolQuantity=new BasketPoolQuantity;var t=document.querySelector(".bx-ordercart-tabs-list"),e=BX("basket_items"),a=BX("delayed_items"),s=BX("coupons_block");t&&(BX.addClass(t,"owl-carousel"),$(t).owlCarousel({autoWidth:!0,nav:!0,navText:['<i class="icon-arrow-left"></i>','<i class="icon-arrow-right"></i>'],navContainer:".bx-ordercart-tabs-scroll",dots:!1})),BX.type.isElementNode(e)&&(checkBasketDelayItemInfoPadding(e),BX.bind(window,"resize",function(){checkBasketDelayItemInfoPadding(e)}),BX.bindDelegate(e,"click",{tagName:"li",attr:{"data-sku-selector":"Y"}},skuPropClickHandler)),BX.type.isElementNode(a)&&(checkBasketDelayItemInfoPadding(a),BX.bind(window,"resize",function(){checkBasketDelayItemInfoPadding(a)})),BX.type.isElementNode(s)&&BX.bindDelegate(s,"click",{attribute:"data-coupon"},deleteCoupon);var i=document.body.querySelector('[data-entity="quickOrder"]');if(i&&(basketJSParams.MIN_ORDER_SUM<=0||parseFloat(basketJSParams.ORDER_SUM)>=parseFloat(basketJSParams.MIN_ORDER_SUM))){var r="true"==i.getAttribute("data-has-object");BX.bind(i,"click",function(t){quickOrder(t,r)})}var l=document.body.querySelector('[data-entity="checkOut"]');l&&(basketJSParams.MIN_ORDER_SUM<=0||parseFloat(basketJSParams.ORDER_SUM)>=parseFloat(basketJSParams.MIN_ORDER_SUM))&&BX.bind(l,"click",function(){checkOut()}),BX.addCustomEvent("quickOrderRequest",function(t,e,a){quickOrderRequest(t,e,a)})});