function updateBasketTable(t,e){var a,i,s,l,r,n,o,u,c,_,d,p,T,A,I,m,B,E,y,S,X,P,N,U,h,b,v,D,C,R,k,Q,f,O,g,M,L,Y,F,x,V,w,q,j,H,K,W,J,G=BX("basket_items"),z=!1,$=!1,Z=!1,tt=!1,et=!1,at=getColumnName(e,"PROPERTY_ARTNUMBER_VALUE"),it=!1,st=getColumnName(e,"PROPERTY_OBJECT_VALUE"),lt=!1;if(G&&"object"==typeof e){if(l=(a=G.querySelectorAll('[data-entity="row"]'))[a.length-1],_="Y"===e.PARAMS.QUANTITY_FLOAT,null!==t&&e.BASKET_DATA&&(d=BX(t),i=e.BASKET_ID,(J=BX.type.isPlainObject(e.BASKET_DATA.GRID.ROWS[i]))&&(s=e.BASKET_DATA.GRID.ROWS[i],(r=BX.create("DIV",{props:{className:"basket-item-tr"},attrs:{"data-entity":"row"}})).setAttribute("id",e.BASKET_ID),r.setAttribute("data-item-name",s.NAME),r.setAttribute("data-item-brand",s[basketJSParams.BRAND_PROPERTY+"_VALUE"]),r.setAttribute("data-item-price",s.PRICE),r.setAttribute("data-item-currency",s.CURRENCY),r.setAttribute("data-item-measure",null!=s.MEASURE_SYMBOL_INTL?s.MEASURE_SYMBOL_INTL:""),l.parentNode.insertBefore(r,d.nextSibling)),"Y"===e.DELETE_ORIGINAL&&(d.parentNode.removeChild(d),J||BX.onCustomEvent("OnBasketChange")),J)){for(r.appendChild(BX.create("DIV",{props:{className:"hidden-xs basket-item-td basket-item-sep"}})),n=e.COLUMNS.split(","),p=0;p<n.length;p++)"DELETE"===n[p]?z=!0:"DELAY"===n[p]?$=!0:"PROPS"===n[p]?Z=!0:"TYPE"===n[p]?tt=!0:"PROPERTY_ARTNUMBER_VALUE"===n[p]?(et=!0,o=n[p]):"PROPERTY_OBJECT_VALUE"===n[p]?(it=!0,u=n[p]):"PROPERTY_M2_COUNT_VALUE"===n[p]&&(lt=!0,c=n[p]);for(p=0;p<n.length;p++)switch(n[p]){case"PROPS":case"DELAY":case"DELETE":case"TYPE":case"PROPERTY_ARTNUMBER_VALUE":case"PROPERTY_OBJECT_VALUE":case"PROPERTY_M2_COUNT_VALUE":case"PROPERTY_OLD_PRICE_VALUE":break;case"NAME":if(A="",s.PREVIEW_PICTURE_SRC.length>0?T=s.PREVIEW_PICTURE_SRC:s.DETAIL_PICTURE_SRC.length>0&&(T=s.DETAIL_PICTURE_SRC),A='<div class="basket-item-image-container"><div class="basket-item-image'+(T.length>0?"":" basket-item-image-empty")+'">',T.length>0&&(A+='<img src="'+T+'" alt="'+s.NAME+'" />'),A+="</div></div>",A+='<div class="basket-item-info"><div class="basket-item-title">',et&&(A+='<span class="basket-item-article">',A+='<span id="col_'+o+'">'+at+"</span>: ",A+=(s[o]?s[o]:"-")+"</span>"),it&&s.PROPERTY_OBJECT_FULL_VALUE&&(A+='<span class="basket-item-object">',A+='<span id="col_'+u+'">'+st+"</span>: ",A+=s.PROPERTY_OBJECT_FULL_VALUE.NAME+"</span>"),s.DETAIL_PAGE_URL.length>0&&(A+='<a href="'+s.DETAIL_PAGE_URL+'">'),A+=s.NAME,s.DETAIL_PAGE_URL.length>0&&(A+="</a>"),Z)for(m=0;m<s.PROPS.length;m++){if(B=s.PROPS[m],s.SKU_DATA){for(E in I=!1,s.SKU_DATA)if(s.SKU_DATA.hasOwnProperty(E)&&(y=s.SKU_DATA[E]).CODE===B.CODE){I=!0;break}if(I)continue}A+='<span class="basket-item-prop">'+BX.util.htmlspecialchars(B.NAME)+": "+B.VALUE+"</span>"}if(s.SKU_DATA){for(H={},h=0;h<s.PROPS.length;h++)H[(b=s.PROPS[h]).CODE]=BX.type.isNotEmptyString(b["~VALUE"])?b["~VALUE"]:b.VALUE;for(E in s.SKU_DATA)if(s.SKU_DATA.hasOwnProperty(E)){for(X in K=0,W=0,(y=s.SKU_DATA[E]).VALUES)W++,S=y.VALUES[X],BX.type.isNotEmptyString(H[y.CODE])&&(H[y.CODE]!=S.NAME&&H[y.CODE]!=S.XML_ID||(K=W));for(U in A+='<div class="basket-item-sku-prop">',A+='<div class="basket-item-sku-title">'+BX.util.htmlspecialchars(y.NAME)+"</div>",A+='<ul class="basket-item-sku-list" id="prop_'+y.CODE+"_"+s.ID+'">',W=0,y.VALUES)N=K==++W?" selected":"",(P=y.VALUES[U]).CODE&&P.CODE.length>0||P.PICT?(style=P.CODE&&P.CODE.length>0?" background-color: #"+P.CODE+";":P.PICT?" background-image: url("+P.PICT.SRC+");":"",A+='<li class="basket-item-sku-item-color'+N+'" \t\t\t\t\t\t\t\t\t\t\t\tdata-sku-selector="Y" \t\t\t\t\t\t\t\t\t\t\t\tdata-value-id="'+P.XML_ID+'" \t\t\t\t\t\t\t\t\t\t\t\tdata-sku-name="'+BX.util.htmlspecialchars(P.NAME)+'" \t\t\t\t\t\t\t\t\t\t\t\tdata-element="'+s.ID+'" \t\t\t\t\t\t\t\t\t\t\t\tdata-property="'+y.CODE+'" \t\t\t\t\t\t\t\t\t\t\t\tstyle="'+style+'"></li>'):A+='<li class="basket-item-sku-item-text'+N+'" \t\t\t\t\t\t\t\t\t\t\t\tdata-sku-selector="Y" \t\t\t\t\t\t\t\t\t\t\t\tdata-value-id="'+("S"===y.TYPE&&"directory"===y.USER_TYPE?P.XML_ID:BX.util.htmlspecialchars(P.NAME))+'" \t\t\t\t\t\t\t\t\t\t\t\tdata-sku-name="'+BX.util.htmlspecialchars(P.NAME)+'" \t\t\t\t\t\t\t\t\t\t\t\tdata-element="'+s.ID+'" \t\t\t\t\t\t\t\t\t\t\t\tdata-property="'+y.CODE+'">'+BX.util.htmlspecialchars(P.NAME)+"</li>";A+="</ul></div>"}}r.appendChild(BX.create("DIV",{props:{className:"basket-item-td basket-item-item"},html:A}));break;case"QUANTITY":v="",lt&&s[c]&&("pc. 1"==s.MEASURE_SYMBOL_INTL||"m2"==s.MEASURE_SYMBOL_INTL)?(R=!1,f=s.PC_QUANTITY,s.PC_QUANTITY=getCorrectRatioQuantity(s.PC_QUANTITY,s.PC_MEASURE_RATIO,!1),f!=s.PC_QUANTITY&&(R=!0),k=!1,O=s.SQ_M_QUANTITY,s.SQ_M_QUANTITY=getCorrectRatioQuantity(s.SQ_M_QUANTITY,s.SQ_M_MEASURE_RATIO,!0),O!=s.SQ_M_QUANTITY&&(k=!0),v+='<div class="basket-item-amount">',v+='<a class="basket-item-amount-btn-minus" href="javascript:void(0)" onclick="setQuantity(\'PC_QUANTITY_INPUT_'+s.ID+"', "+s.ID+", "+s.PC_MEASURE_RATIO+", 'down', false);\">-</a>",v+='<input type="text" class="basket-item-amount-input" id="PC_QUANTITY_INPUT_'+s.ID+'" \t\t\t\t\t\t\t\tname="PC_QUANTITY_INPUT_'+s.ID+'" \t\t\t\t\t\t\t\tmaxlength="18" \t\t\t\t\t\t\t\tvalue="'+s.PC_QUANTITY+'" \t\t\t\t\t\t\t\tonchange="updatePcQuantity(\'PC_QUANTITY_INPUT_'+s.ID+"', "+s.ID+", "+s.PC_MEASURE_RATIO+', false);" \t\t\t\t\t\t\t\tdata-ratio="'+s.PC_MEASURE_RATIO+'" \t\t\t\t\t\t\t\t/>',v+='<a class="basket-item-amount-btn-plus" href="javascript:void(0)" onclick="setQuantity(\'PC_QUANTITY_INPUT_'+s.ID+"', "+s.ID+", "+s.PC_MEASURE_RATIO+", 'up', false);\">+</a>",v+='<div class="basket-item-amount-measure">'+BX.message("MEASURE_PC")+"</div>",v+="</div>",v+='<div class="basket-item-amount">',v+='<a class="basket-item-amount-btn-minus" href="javascript:void(0)" onclick="setQuantity(\'SQ_M_QUANTITY_INPUT_'+s.ID+"', "+s.ID+", "+s.SQ_M_MEASURE_RATIO+", 'down', true);\">-</a>",v+='<input type="text" class="basket-item-amount-input" id="SQ_M_QUANTITY_INPUT_'+s.ID+'" \t\t\t\t\t\t\t\tname="SQ_M_QUANTITY_INPUT_'+s.ID+'" \t\t\t\t\t\t\t\tmaxlength="18" \t\t\t\t\t\t\t\tvalue="'+s.SQ_M_QUANTITY+'" \t\t\t\t\t\t\t\tonchange="updateSqMQuantity(\'SQ_M_QUANTITY_INPUT_'+s.ID+"', "+s.ID+", "+s.SQ_M_MEASURE_RATIO+', true);" \t\t\t\t\t\t\t\tdata-ratio="'+s.SQ_M_MEASURE_RATIO+'" \t\t\t\t\t\t\t\t/>',v+='<a class="basket-item-amount-btn-plus" href="javascript:void(0)" onclick="setQuantity(\'SQ_M_QUANTITY_INPUT_'+s.ID+"', "+s.ID+", "+s.SQ_M_MEASURE_RATIO+", 'up', true);\">+</a>",v+='<div class="basket-item-amount-measure">'+BX.message("MEASURE_SQ_M")+"</div>",v+="</div>"):(C=!1,0!=(D=parseFloat(s.MEASURE_RATIO)>0?s.MEASURE_RATIO:1)&&""!=D&&(Q=s.QUANTITY,s.QUANTITY=getCorrectRatioQuantity(s.QUANTITY,D,_),Q!=s.QUANTITY&&(C=!0)),v+='<div class="basket-item-amount">',0!=D&&""!=D&&(v+='<a class="basket-item-amount-btn-minus" href="javascript:void(0)" onclick="setQuantity(\'QUANTITY_INPUT_'+s.ID+"', "+s.ID+", "+s.MEASURE_RATIO+", 'down', "+_+');">-</a>'),v+='<input type="text" class="basket-item-amount-input" id="QUANTITY_INPUT_'+s.ID+'" \t\t\t\t\t\t\t\tname="QUANTITY_INPUT_'+s.ID+'" \t\t\t\t\t\t\t\tmaxlength="18" \t\t\t\t\t\t\t\tvalue="'+s.QUANTITY+'" \t\t\t\t\t\t\t\tonchange="updateQuantity(\'QUANTITY_INPUT_'+s.ID+"', "+s.ID+", "+D+", "+_+')" \t\t\t\t\t\t\t\t/>',0!=D&&""!=D&&(v+='<a class="basket-item-amount-btn-plus" href="javascript:void(0)" onclick="setQuantity(\'QUANTITY_INPUT_'+s.ID+"', "+s.ID+", "+s.MEASURE_RATIO+", 'up', "+_+');">+</a>'),s.hasOwnProperty("MEASURE_TEXT")&&s.MEASURE_TEXT.length>0&&(v+='<div class="basket-item-amount-measure">'+BX.util.htmlspecialchars(s.MEASURE_TEXT)+"</div>"),v+="</div>"),v+='<input type="hidden" id="QUANTITY_'+s.ID+'" name="QUANTITY_'+s.ID+'" value="'+s.QUANTITY+'" />',r.appendChild(BX.create("DIV",{props:{className:"basket-item-td"},html:v})),C&&updateQuantity("QUANTITY_INPUT_"+s.ID,s.ID,D,_),R?updatePcQuantity("PC_QUANTITY_INPUT_"+s.ID,s.ID,s.PC_MEASURE_RATIO,!1):k&&updateSqMQuantity("SQ_M_QUANTITY_INPUT_"+s.ID,s.ID,s.SQ_M_MEASURE_RATIO,!0);break;case"PRICE":g="",M=s.DISCOUNT_PRICE_PERCENT>0?s.SQ_M_FULL_PRICE?s.SQ_M_FULL_PRICE_FORMATED:s.FULL_PRICE_FORMATED:"",g+='<div id="current_price_'+s.ID+'"><span data-entity="price-current">'+(s.SQ_M_PRICE?s.SQ_M_PRICE_FORMATED:s.PRICE_FORMATED)+"</span>",lt&&s[c]&&("pc. 1"==s.MEASURE_SYMBOL_INTL||"m2"==s.MEASURE_SYMBOL_INTL)&&(g+="<span>/"+BX.message("MEASURE_SQ_M")+"</span>"),g+="</div>",g+='<div class="basket-item-old-price" id="old_price_'+s.ID+'">'+M+"</div>",tt&&s.NOTES.length>0&&(g+='<div class="basket-item-type-price">'+basketJSParams.SALE_TYPE+"</div>",g+='<div class="basket-item-type-price-value">'+s.NOTES+"</div>"),r.appendChild(BX.create("DIV",{props:{className:"hidden-xs basket-item-td"},html:g}));break;case"DISCOUNT":Y='<div id="discount_value_'+s.ID+'">'+s.DISCOUNT_PRICE_PERCENT_FORMATED+"</div>",r.appendChild(BX.create("DIV",{props:{className:"hidden-xs basket-item-td basket-item-discount-percent"},html:Y}));break;case"WEIGHT":r.appendChild(BX.create("DIV",{props:{className:"hidden-xs basket-item-td"},html:s.WEIGHT_FORMATED}));break;case"SUM":F='<div id="sum_'+s.ID+'">',void 0!==s[n[p]]&&(F+=s[n[p]]),F+="</div>",r.appendChild(BX.create("DIV",{props:{className:"basket-item-td basket-item-sum"},html:F}));break;default:x="",void 0!==s[n[p]]&&(x+=s[n[p]]),r.appendChild(BX.create("DIV",{props:{className:"hidden-xs basket-item-td"},html:x}))}z||$?(V="",$&&(V+='<a class="basket-item-control" \t\t\t\t\t\thref="'+basketJSParams.DELAY_URL.replace("#ID#",s.ID)+'" \t\t\t\t\t\ttitle="'+basketJSParams.SALE_DELAY+'">\t\t\t\t\t\t<i class="icon-star"></i></a>'),z&&(V+='<a class="basket-item-control" \t\t\t\t\t\thref="'+basketJSParams.DELETE_URL.replace("#ID#",s.ID)+'" \t\t\t\t\t\ttitle="'+basketJSParams.SALE_DELETE+'">\t\t\t\t\t\t<i class="icon-close"></i></a>'),r.appendChild(BX.create("DIV",{props:{className:"basket-item-td basket-item-sep"},style:{position:"relative"},children:[BX.create("DIV",{props:{className:"basket-item-controls"},html:V})]}))):r.appendChild(BX.create("DIV",{props:{className:"hidden-xs basket-item-td basket-item-sep"}})),w=BX(s.ID).querySelector(".basket-item-info"),j=!!(q=BX(s.ID).querySelector(".basket-item-controls"))&&q.querySelectorAll(".basket-item-control"),w&&j&&(window.innerWidth<992?BX.style(w,"padding-right",q.offsetWidth+"px"):BX.style(w,"padding-right",""))}if(e.BASKET_DATA)for(L in e.BASKET_DATA.GRID.ROWS)if(e.BASKET_DATA.GRID.ROWS.hasOwnProperty(L)){var rt=e.BASKET_DATA.GRID.ROWS[L];BX("discount_value_"+L)&&(BX("discount_value_"+L).innerHTML=rt.DISCOUNT_PRICE_PERCENT_FORMATED),BX("current_price_"+L)&&(BX("current_price_"+L).querySelector('[data-entity="price-current"]').innerHTML=rt.SQ_M_PRICE?rt.SQ_M_PRICE_FORMATED:rt.PRICE_FORMATED),BX("old_price_"+L)&&(BX("old_price_"+L).innerHTML=rt.DISCOUNT_PRICE_PERCENT>0?rt.SQ_M_FULL_PRICE?rt.SQ_M_FULL_PRICE_FORMATED:rt.FULL_PRICE_FORMATED:""),BX("sum_"+L)&&(BX("sum_"+L).innerHTML=rt.SUM),BX("QUANTITY_"+L)&&(BX("QUANTITY_INPUT_"+L)&&(BX("QUANTITY_INPUT_"+L).value=rt.QUANTITY,BX("QUANTITY_INPUT_"+L).defaultValue=rt.QUANTITY),BX("PC_QUANTITY_INPUT_"+L)&&BX("SQ_M_QUANTITY_INPUT_"+L)&&(BX("PC_QUANTITY_INPUT_"+L).value=rt.PC_QUANTITY,BX("PC_QUANTITY_INPUT_"+L).defaultValue=rt.PC_QUANTITY,BX("SQ_M_QUANTITY_INPUT_"+L).value=rt.SQ_M_QUANTITY,BX("SQ_M_QUANTITY_INPUT_"+L).defaultValue=rt.SQ_M_QUANTITY),BX("QUANTITY_"+L).value=rt.QUANTITY)}if(e.BASKET_DATA&&couponListUpdate(e.BASKET_DATA),e.BASKET_DATA){var nt=BX("warning_message"),ot=[];if(e.hasOwnProperty("WARNING_MESSAGE")){for(p=0;p<e.WARNING_MESSAGE.length;p++)ot[p]=e.WARNING_MESSAGE[p];nt.appendChild(BX.create("span",{props:{className:"alert alert-warning"},style:{display:"block"},html:ot.join("<br />")})),nt.style.display="block"}else nt.innerHTML="",nt.style.display="none"}if(e.BASKET_DATA){BX("allWeight_FORMATED")&&(BX("allWeight_FORMATED").innerHTML=e.BASKET_DATA.allWeight_FORMATED),BX("allSum_wVAT_FORMATED")&&(BX("allSum_wVAT_FORMATED").innerHTML=e.BASKET_DATA.allSum_wVAT_FORMATED),BX("allVATSum_FORMATED")&&(BX("allVATSum_FORMATED").innerHTML=e.BASKET_DATA.allVATSum_FORMATED),BX("allSum_FORMATED")&&(BX("allSum_FORMATED").innerHTML=e.BASKET_DATA.allSum_FORMATED);var ut=e.BASKET_DATA.PRICE_WITHOUT_DISCOUNT!=e.BASKET_DATA.allSum_FORMATED;BX("PRICE_WITHOUT_DISCOUNT")&&(BX("PRICE_WITHOUT_DISCOUNT").innerHTML=ut?e.BASKET_DATA.PRICE_WITHOUT_DISCOUNT:"",BX.style(BX("PRICE_WITHOUT_DISCOUNT"),"display",ut?"block":"none")),BX("DISCOUNT_PRICE_ALL_FORMATED")&&(BX("DISCOUNT_PRICE_ALL_FORMATED").innerHTML=ut?basketJSParams.SALE_TOTAL_DISCOUNT+" "+e.BASKET_DATA.DISCOUNT_PRICE_ALL_FORMATED:"",BX.style(BX("DISCOUNT_PRICE_ALL_FORMATED"),"display",ut?"block":"none")),BX.onCustomEvent("OnBasketTableChange")}}}function couponCreate(t,e){var a="disabled";BX.type.isElementNode(t)&&("BAD"===e.JS_STATUS?a="bad":"APPLYED"===e.JS_STATUS&&(a="good"),t.appendChild(BX.create("div",{props:{className:"bx_ordercart_coupon"},children:[BX.create("input",{props:{type:"hidden",name:"OLD_COUPON[]",value:e.COUPON}}),BX.create("span",{props:{className:"bx_ordercart_coupon_note "+a},html:e.COUPON+" "+e.JS_CHECK_CODE}),BX.create("span",{props:{className:"bx_ordercart_coupon_close_container"},children:[BX.create("span",{props:{className:"bx_ordercart_coupon_close"},attrs:{"data-coupon":e.COUPON}})]})]})))}function couponListUpdate(t){var e,a,i,s,l,r,n,o,u;if(!t||"object"==typeof t){if((e=BX("coupons_block"))&&t.COUPON_LIST&&BX.type.isArray(t.COUPON_LIST))if((i=BX("coupon"))&&(i.value=""),s=BX.findChildren(e,{tagName:"input",property:{name:"OLD_COUPON[]"}},!0)){for(BX.type.isElementNode(s)&&(s=[s]),n=0;n<t.COUPON_LIST.length;n++){for(l=!1,u=-1,o=0;o<s.length;o++)if(s[o].value===t.COUPON_LIST[n].COUPON){l=!0,u=o,s[o].couponUpdate=!0;break}l?(a="disabled","BAD"===t.COUPON_LIST[n].JS_STATUS?a="bad":"APPLYED"===t.COUPON_LIST[n].JS_STATUS&&(a="good"),(r=BX.findNextSibling(s[u],{className:"bx_ordercart_coupon_note"}))&&BX.adjust(r,{props:{className:"bx_ordercart_coupon_note "+a},html:t.COUPON_LIST[n].COUPON+" "+t.COUPON_LIST[n].JS_CHECK_CODE})):couponCreate(e,t.COUPON_LIST[n])}for(o=0;o<s.length;o++)void 0!==s[o].couponUpdate&&s[o].couponUpdate?s[o].couponUpdate=null:(BX.remove(s[o].parentNode),s[o]=null)}else for(n=0;n<t.COUPON_LIST.length;n++)couponCreate(e,t.COUPON_LIST[n]);e=null}}function skuPropClickHandler(){var t,e,a,i,s,l,r,n={},o={};if(this&&this.hasAttribute("data-value-id")){if(BX.showWait(),t=this.getAttribute("data-element"),e=this.getAttribute("data-property"),a=BX("action_var").value,n[e]=BX.util.htmlspecialcharsback(this.getAttribute("data-value-id")),BX.hasClass(this,"selected"))return void BX.closeWait();if((i=BX.findChildren(BX(t),{tagName:"ul",className:"basket-item-sku-list"},!0))&&i.length>0)for(s=0;i.length>s;s++)if(i[s].id!=="prop_"+e+"_"+t&&(l=BX.findChildren(BX(i[s].id),{tagName:"li",className:"selected"},!0))&&l.length>0)for(r=0;l.length>r;r++)l[r].hasAttribute("data-value-id")&&(n[l[r].getAttribute("data-property")]=BX.util.htmlspecialcharsback(l[r].getAttribute("data-value-id")));(o={basketItemId:t,sessid:BX.bitrix_sessid(),site_id:BX.message("SITE_ID"),props:n,action_var:a,select_props:BX("column_headers").value,offers_props:BX("offers_props").value,quantity_float:BX("quantity_float").value,price_vat_show_value:BX("price_vat_show_value").value,hide_coupon:BX("hide_coupon").value,use_prepayment:BX("use_prepayment").value,via_ajax:"Y",template:basketJSParams.SIGNED_TEMPLATE,signedParamsString:basketJSParams.SIGNED_PARAMS})[a]="select_item",BX.ajax({url:"/bitrix/components/altop/sale.basket.basket/ajax.php",method:"POST",data:o,dataType:"json",onsuccess:function(e){BX.closeWait(),updateBasketTable(t,e)}})}}function getColumnName(t,e){return BX("col_"+e)?BX.util.trim(BX("col_"+e).innerHTML):""}function checkOut(){return BX("coupon")&&(BX("coupon").disabled=!0),BX("basket_form").submit(),!0}function updateBasket(){recalcBasketAjax({})}function enterCoupon(){var t=BX("coupon");t&&t.value&&recalcBasketAjax({coupon:t.value})}function updateQuantity(t,e,a,i){var s=BX(t).defaultValue,l=parseFloat(BX(t).value)||0,r=!1,n=BX("auto_calculation")&&"Y"==BX("auto_calculation").value||!BX("auto_calculation");0===a||1==a?r=!0:0===1e4*l%(1e4*a)&&(r=!0);var o=!1;parseInt(l)!=parseFloat(l)&&(o=!0),l=correctQuantity(l=!1===i&&!1===o?parseInt(l):parseFloat(l).toFixed(4)),r?(BX(t).defaultValue=l,BX(t).value=l,BX("QUANTITY_"+e).value=l,n&&basketPoolQuantity.changeQuantity(e)):(l=correctQuantity(l=getCorrectRatioQuantity(l,a,i)))!=s?(BX(t).defaultValue=l,BX(t).value=l,BX("QUANTITY_"+e).value=l,n&&basketPoolQuantity.changeQuantity(e)):BX(t).value=s}function updatePcQuantity(t,e,a,i){var s=BX("basket_items").querySelector('[id="'+e+'"]'),l=!!s&&s.getAttribute("data-item-measure"),r=BX(t).defaultValue,n=parseFloat(BX(t).value)||0,o=!1,u=BX("auto_calculation")&&"Y"==BX("auto_calculation").value||!BX("auto_calculation"),c=!1;0===a||1==a?o=!0:0===1e4*n%(1e4*a)&&(o=!0);var _=!1;parseInt(n)!=parseFloat(n)&&(_=!0),n=correctQuantity(n=!1===i&&!1===_?parseInt(n):parseFloat(n).toFixed(4)),o?(BX(t).defaultValue=n,BX(t).value=n,l&&"pc. 1"==l&&(BX("QUANTITY_"+e).value=n,c=!0)):(n=correctQuantity(n=getCorrectRatioQuantity(n,a,i)))!=r?(BX(t).defaultValue=n,BX(t).value=n,l&&"pc. 1"==l&&(BX("QUANTITY_"+e).value=n,c=!0)):BX(t).value=r;var d=BX("SQ_M_QUANTITY_INPUT_"+e),p=d.defaultValue,T=parseFloat(d.getAttribute("data-ratio")),A=parseFloat(BX(t).value*T/a)||0,I=!1;0===T||1==T?I=!0:0===1e4*A%(1e4*T)&&(I=!0);parseInt(A),parseFloat(A),A=correctQuantity(A=parseFloat(A).toFixed(4)),I?(d.defaultValue=A,d.value=A,l&&"m2"==l&&(BX("QUANTITY_"+e).value=A,c=!0)):(A=correctQuantity(A=getCorrectRatioQuantity(A,T,!0)))!=p?(d.defaultValue=A,d.value=A,l&&"m2"==l&&(BX("QUANTITY_"+e).value=A,c=!0)):d.value=p,u&&c&&basketPoolQuantity.changeQuantity(e)}function updateSqMQuantity(t,e,a,i){var s=BX("basket_items").querySelector('[id="'+e+'"]'),l=!!s&&s.getAttribute("data-item-measure"),r=BX(t).defaultValue,n=parseFloat(BX(t).value)||0,o=!1,u=BX("auto_calculation")&&"Y"==BX("auto_calculation").value||!BX("auto_calculation"),c=!1;0===a||1==a?o=!0:0===1e4*n%(1e4*a)&&(o=!0);var _=!1;parseInt(n)!=parseFloat(n)&&(_=!0),n=correctQuantity(n=!1===i&&!1===_?parseInt(n):parseFloat(n).toFixed(4)),o?(BX(t).defaultValue=n,BX(t).value=n,l&&"m2"==l&&(BX("QUANTITY_"+e).value=n,c=!0)):(n=correctQuantity(n=getCorrectRatioQuantity(n,a,i)))!=r?(BX(t).defaultValue=n,BX(t).value=n,l&&"m2"==l&&(BX("QUANTITY_"+e).value=n,c=!0)):BX(t).value=r;var d=BX("PC_QUANTITY_INPUT_"+e),p=d.defaultValue,T=parseFloat(d.getAttribute("data-ratio")),A=parseFloat(BX(t).value*T/a)||0,I=!1;0===T||1==T?I=!0:0===1e4*A%(1e4*T)&&(I=!0);parseInt(A),parseFloat(A),A=correctQuantity(A=!1===_?parseInt(A):parseFloat(A).toFixed(4)),I?(d.defaultValue=A,d.value=A,l&&"pc. 1"==l&&(BX("QUANTITY_"+e).value=A,c=!0)):(A=correctQuantity(A=getCorrectRatioQuantity(A,T,!1)))!=p?(d.defaultValue=A,d.value=A,l&&"pc. 1"==l&&(BX("QUANTITY_"+e).value=A,c=!0)):d.value=p,u&&c&&basketPoolQuantity.changeQuantity(e)}function setQuantity(t,e,a,i,s){var l,r=parseFloat(BX(t).value);if(BX(t).defaultValue=r,(l="up"==i?r+a:r-a)<0&&(l=0),s&&(l=parseFloat(l).toFixed(4)),l=correctQuantity(l),a>0&&l<a&&(l=a),s||l==l.toFixed(4)||(l=parseFloat(l).toFixed(4)),l=correctQuantity(l=getCorrectRatioQuantity(l,a,s)),BX(t).value=l,t=="PC_QUANTITY_INPUT_"+e){var n,o=BX("SQ_M_QUANTITY_INPUT_"+e),u=parseFloat(o.value),c=parseFloat(o.getAttribute("data-ratio"));o.defaultValue=u,(n="up"==i?u+c:u-c)<0&&(n=0),n=correctQuantity(n=parseFloat(n).toFixed(4)),c>0&&n<c&&(n=c),n=correctQuantity(n=getCorrectRatioQuantity(n,c,!0)),o.value=n,updatePcQuantity(t,e,a,s)}else if(t=="SQ_M_QUANTITY_INPUT_"+e){var _,d=BX("PC_QUANTITY_INPUT_"+e),p=parseFloat(d.value),T=parseFloat(d.getAttribute("data-ratio"));d.defaultValue=p,(_="up"==i?p+T:p-T)<0&&(_=0),_=correctQuantity(_),T>0&&_<T&&(_=T),_!=_.toFixed(4)&&(_=parseFloat(_).toFixed(4)),_=correctQuantity(_=getCorrectRatioQuantity(_,T,!1)),d.value=_,updateSqMQuantity(t,e,a,s)}else updateQuantity(t,e,a,s)}function getCorrectRatioQuantity(t,e,a){var i,s=(t/e-(t/e).toFixed(0)).toFixed(6),l=t,r=!1;if(e=parseFloat(e),0==s)return l;if(0!==e&&1!=e)for(i=e,max=parseFloat(t)+parseFloat(e);i<=max;i=parseFloat(parseFloat(i)+parseFloat(e)).toFixed(4))l=i;else 1===e&&(l=0|t);return parseInt(l,10)!=parseFloat(l)&&(r=!0),l=correctQuantity(l=!1===a&&!1===r?parseInt(l,10):parseFloat(l).toFixed(4))}function correctQuantity(t){return parseFloat((1*t).toString())}function recalcBasketAjax(t){if(basketPoolQuantity.isProcessing())return!1;BX.showWait();var e,a,i=BX("action_var").value,s=BX("basket_items")&&BX("basket_items").querySelectorAll('[data-entity="row"]'),l=BX("delayed_items")&&BX("delayed_items").querySelectorAll('[data-entity="row"]');if((e={sessid:BX.bitrix_sessid(),site_id:BX.message("SITE_ID"),props:{},action_var:i,select_props:BX("column_headers").value,offers_props:BX("offers_props").value,quantity_float:BX("quantity_float").value,price_vat_show_value:BX("price_vat_show_value").value,hide_coupon:BX("hide_coupon").value,use_prepayment:BX("use_prepayment").value,via_ajax:"Y",template:basketJSParams.SIGNED_TEMPLATE,signedParamsString:basketJSParams.SIGNED_PARAMS})[i]="recalculate",t&&"object"==typeof t)for(a in t)t.hasOwnProperty(a)&&(e[a]=t[a]);if(s&&s.length>0)for(a=0;s.length>a;a++)e["QUANTITY_"+s[a].id]=BX("QUANTITY_"+s[a].id).value;if(l&&l.length>0)for(a=0;l.length>a;a++)e["DELAY_"+l[a].id]="Y";basketPoolQuantity.setProcessing(!0),basketPoolQuantity.clearPool(),BX.ajax({url:"/bitrix/components/altop/sale.basket.basket/ajax.php",method:"POST",data:e,dataType:"json",onsuccess:function(e){BX.closeWait(),basketPoolQuantity.setProcessing(!1),t.coupon&&e&&e.BASKET_DATA&&e.BASKET_DATA.NEED_TO_RELOAD_FOR_GETTING_GIFTS&&BX.reload(),basketPoolQuantity.isPoolEmpty()?(updateBasketTable(null,e),basketPoolQuantity.updateQuantity()):basketPoolQuantity.enableTimer(!0)}})}function showBasketItemsList(t){var e=document.body.querySelector('[data-entity="tabs"]'),a=e&&e.querySelectorAll('[data-entity="tab"]'),i=e&&e.querySelector('[data-value="basket-items"]'),s=e&&e.querySelector('[data-value="basket-items-delayed"]'),l=e&&e.querySelector('[data-entity="print"]'),r=e&&e.querySelector('[data-entity="clear"]'),n=e&&e.querySelector('[data-entity="clearDelay"]'),o=BX("basket_items_list"),u=BX("basket_items"),c=BX("basket_items_delayed"),_=BX("delayed_items");if(a)for(var d in a)a.hasOwnProperty(d)&&BX.removeClass(a[d],"active");2==t?(s&&BX.addClass(s,"active"),r&&BX.style(r,"display","none"),_?(l&&BX.style(l,"display","flex"),n&&BX.style(n,"display","flex")):(l&&BX.style(l,"display","none"),n&&BX.style(n,"display","none")),o&&(o.style.display="none"),c&&(c.style.display="block"),_&&checkBasketDelayItemInfoPadding(_)):(i&&BX.addClass(i,"active"),n&&BX.style(n,"display","none"),u?(l&&BX.style(l,"display","flex"),r&&BX.style(r,"display","flex")):(l&&BX.style(l,"display","none"),r&&BX.style(r,"display","none")),o&&(o.style.display="block"),c&&(c.style.display="none"),u&&checkBasketDelayItemInfoPadding(u))}function checkBasketDelayItemInfoPadding(t){if(!BX.isNodeHidden(t)){var e=t.querySelectorAll('[data-entity="row"]');if(e&&e.length>0)for(var a=0;e.length>a;a++){var i=e[a].querySelector(".basket-item-info"),s=e[a].querySelector(".basket-item-controls"),l=!!s&&s.querySelectorAll(".basket-item-control");i&&l&&(window.innerWidth<992?BX.style(i,"padding-right",s.offsetWidth+"px"):BX.style(i,"padding-right",""))}}}function deleteCoupon(){var t;this&&this.hasAttribute("data-coupon")&&(t=this.getAttribute("data-coupon"))&&t.length>0&&recalcBasketAjax({delete_coupon:t})}function deleteProductRow(t){var e,a,i=BX.findParent(t,{className:"basket-item-tr"});return i&&(e=BX("QUANTITY_"+i.id))&&(a=getCurrentItemAnalyticsInfo(i,e.value)),setAnalyticsDataLayer([],[a]),document.location.href=t.href,!1}function quickOrderRequest(t,e,a){BX.ajax({url:basketJSParams.SITE_DIR+"ajax/slide_panel.php",method:"POST",dataType:"json",timeout:60,data:{action:t?"quick_order_objects":"quick_order"},onsuccess:BX.delegate(function(t){t.content&&t.JS?BX.ajax.processScripts(BX.processHTML(t.JS).SCRIPT,!1,BX.delegate(function(){var i=BX.processHTML(t.content),s=BX.create("DIV");s.innerHTML=i.HTML;var l=e.querySelector(".slide-panel__title"),r=s.querySelector(".quick-order-form-title");r&&(l.innerHTML=r.innerHTML,BX.remove(r)),a.innerHTML=s.innerHTML,BX.ajax.processScripts(i.SCRIPT)},this)):(BX.cleanNode(a),a.appendChild(BX.create("DIV",{props:{className:"slide-panel__form"},children:[BX.create("DIV",{props:{className:"alert alert-error alert-show"},html:BX.message("SLIDE_PANEL_UNDEFINED_ERROR")})]}))),$(a).scrollbar()},this)})}function quickOrder(t,e){var a=document.querySelector(".slide-panel");if(a){a.appendChild(BX.create("DIV",{props:{className:"slide-panel__title-wrap"},children:[BX.create("I",{props:{className:"icon-bolt"}}),BX.create("SPAN",{props:{className:"slide-panel__title"}}),BX.create("SPAN",{props:{className:"slide-panel__close"},children:[BX.create("I",{props:{className:"icon-close"}})]})]})),a.appendChild(BX.create("DIV",{props:{className:"slide-panel__content scrollbar-inner"},children:[BX.create("DIV",{props:{className:"slide-panel__loader"},html:"<div><span></span></div>"})]}));var i=a.querySelector(".slide-panel__content");i&&BX.onCustomEvent("quickOrderRequest",[e,a,i]);var s=window.innerWidth-document.body.clientWidth;if(s>0){BX.style(document.body,"padding-right",s+"px");var l=document.querySelector(".page-bg");l&&BX.style(l,"margin-right",s+"px");var r=document.querySelector(".top-panel");if(r){BX.hasClass(r,"fixed")&&BX.style(r,"padding-right",s+"px");var n=r.querySelector(".top-panel__thead");n&&BX.hasClass(n,"fixed")&&BX.style(n,"padding-right",s+"px");var o=r.querySelector(".top-panel__tfoot");o&&BX.hasClass(o,"fixed")&&BX.style(o,"padding-right",s+"px")}}var u=BX.GetWindowScrollPos().scrollTop;u&&u>0&&BX.style(document.body,"top","-"+u+"px"),BX.addClass(document.body,"slide-panel-active"),BX.addClass(a,"active"),document.body.appendChild(BX.create("DIV",{props:{className:"modal-backdrop slide-panel__backdrop fadeInBig"}})),t.stopPropagation()}}function checkAnalytics(t,e){if(t&&e&&0!==BX.util.array_values(t).length){var a,i,s,l={},r=[],n=[];if(e&&e.length)for(s=0;e.length>s;s++)a=e[s].id,0!=(i=BX("QUANTITY_"+a).value-t[a])&&(l=getCurrentItemAnalyticsInfo(e[s],i),i>0?r.push(l):n.push(l));(r.length||n.length)&&setAnalyticsDataLayer(r,n)}}function getCurrentItemAnalyticsInfo(t,e){if(t){var a,i,s=[],l={name:t.getAttribute("data-item-name")||"",id:t.id,price:t.getAttribute("data-item-price")||0,brand:(t.getAttribute("data-item-brand")||"").split(",  ").join("/"),variant:"",quantity:Math.abs(e)};for(a=t.querySelectorAll(".selected[data-sku-name]"),i=0;i<a.length;i++)s.push(a[i].getAttribute("data-sku-name"));return l.variant=s.join("/"),l}}function setAnalyticsDataLayer(t,e){window[basketJSParams.DATA_LAYER_NAME]=window[basketJSParams.DATA_LAYER_NAME]||[],t&&t.length&&window[basketJSParams.DATA_LAYER_NAME].push({event:"addToCart",ecommerce:{currencyCode:getCurrencyCode(),add:{products:t}}}),e&&e.length&&window[basketJSParams.DATA_LAYER_NAME].push({event:"removeFromCart",ecommerce:{currencyCode:getCurrencyCode(),remove:{products:e}}})}function getCurrencyCode(){var t,e=BX("basket_items"),a="";return e&&(t=e.querySelector("[data-item-currency"))&&(a=t.getAttribute("data-item-currency")),a}BasketPoolQuantity=function(){this.processing=!1,this.poolQuantity={},this.updateTimer=null,this.currentQuantity={},this.lastStableQuantities={},this.updateQuantity()},BasketPoolQuantity.prototype.updateQuantity=function(){var t=BX("basket_items")&&BX("basket_items").querySelectorAll('[data-entity="row"]');if("Y"===basketJSParams.USE_ENHANCED_ECOMMERCE&&checkAnalytics(this.lastStableQuantities,t),t&&t.length>0)for(var e=0;t.length>e;e++){var a=t[e].id;this.currentQuantity[a]=BX("QUANTITY_"+a).value}this.lastStableQuantities=BX.clone(this.currentQuantity,!0)},BasketPoolQuantity.prototype.changeQuantity=function(t){var e=BX("QUANTITY_"+t).value,a=this.isPoolEmpty();this.currentQuantity[t]&&this.currentQuantity[t]!=e&&(this.poolQuantity[t]=this.currentQuantity[t]=e),a?this.trySendPool():this.enableTimer(!0)},BasketPoolQuantity.prototype.trySendPool=function(){this.isPoolEmpty()||this.isProcessing()||(this.enableTimer(!1),recalcBasketAjax({}))},BasketPoolQuantity.prototype.isPoolEmpty=function(){return 0==Object.keys(this.poolQuantity).length},BasketPoolQuantity.prototype.clearPool=function(){this.poolQuantity={}},BasketPoolQuantity.prototype.isProcessing=function(){return!0===this.processing},BasketPoolQuantity.prototype.setProcessing=function(t){this.processing=!0===t},BasketPoolQuantity.prototype.enableTimer=function(t){clearTimeout(this.updateTimer),!1!==t&&(this.updateTimer=setTimeout(function(){basketPoolQuantity.trySendPool()},1500))},BX.ready(function(){"?delay=Y"==window.location.search&&showBasketItemsList(2),basketPoolQuantity=new BasketPoolQuantity;var t=document.querySelector(".bx-ordercart-tabs-list"),e=BX("basket_items"),a=BX("delayed_items"),i=BX("coupons_block");t&&(BX.addClass(t,"owl-carousel"),$(t).owlCarousel({autoWidth:!0,nav:!0,navText:['<i class="icon-arrow-left"></i>','<i class="icon-arrow-right"></i>'],navContainer:".bx-ordercart-tabs-scroll",dots:!1})),BX.type.isElementNode(e)&&(checkBasketDelayItemInfoPadding(e),BX.bind(window,"resize",function(){checkBasketDelayItemInfoPadding(e)}),BX.bindDelegate(e,"click",{tagName:"li",attr:{"data-sku-selector":"Y"}},skuPropClickHandler)),BX.type.isElementNode(a)&&(checkBasketDelayItemInfoPadding(a),BX.bind(window,"resize",function(){checkBasketDelayItemInfoPadding(a)})),BX.type.isElementNode(i)&&BX.bindDelegate(i,"click",{attribute:"data-coupon"},deleteCoupon),BX.addCustomEvent("quickOrderRequest",function(t,e,a){quickOrderRequest(t,e,a)})});