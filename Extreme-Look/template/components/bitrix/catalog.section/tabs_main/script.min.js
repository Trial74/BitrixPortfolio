!function(){"use strict";window.JCCatalogSectionComponent||(window.JCCatalogSectionComponent=function(t){this.formPosting=!1,this.siteId=t.siteId||"",this.ajaxId=t.ajaxId||"",this.template=t.template||"",this.componentPath=t.componentPath||"",this.parameters=t.parameters||"",t.navParams&&(this.navParams={NavNum:t.navParams.NavNum||1,NavPageNomer:parseInt(t.navParams.NavPageNomer)||1,NavPageCount:parseInt(t.navParams.NavPageCount)||1}),this.bigData=t.bigData||{enabled:!1},this.container=document.querySelector("[data-entity='container-"+this.navParams.NavNum+"']"),this.showMoreButton=null,this.showMoreButtonMessage=null,this.showMoreButtonContainer=null,this.bigData.enabled&&BX.util.object_keys(this.bigData.rows).length>0&&(BX.cookie_prefix=this.bigData.js.cookiePrefix||"",BX.cookie_domain=this.bigData.js.cookieDomain||"",BX.current_server_time=this.bigData.js.serverTime,BX.ready(BX.proxy(this.bigDataLoad,this))),t.initiallyShowHeader&&BX.ready(BX.delegate(this.showHeader,this)),t.deferredLoad&&BX.ready(BX.proxy(this.deferredLoad,this)),t.lazyLoad&&(this.showMoreButton=document.querySelector('[data-use="show-more-'+this.navParams.NavNum+'"]'),this.showMoreButtonMessage=this.showMoreButton.innerHTML,this.showMoreButtonContainer=document.querySelector('[data-entity="catalog-show-more-container"]'),BX.bind(this.showMoreButton,"click",BX.proxy(this.showMore,this))),t.loadOnScroll&&BX.bind(window,"scroll",BX.proxy(this.loadOnScroll,this))},window.JCCatalogSectionComponent.prototype={checkButton:function(){this.showMoreButton&&(this.navParams.NavPageNomer==this.navParams.NavPageCount?BX.remove(this.showMoreButtonContainer):BX.insertAfter(this.showMoreButtonContainer,this.container))},enableButton:function(){this.showMoreButton&&(BX.removeClass(this.showMoreButton,"disabled"),this.showMoreButton.innerHTML=this.showMoreButtonMessage)},disableButton:function(){this.showMoreButton&&(BX.addClass(this.showMoreButton,"disabled"),this.showMoreButton.innerHTML=BX.message("BTN_MESSAGE_LAZY_LOAD_WAITER"))},loadOnScroll:function(){var t=BX.GetWindowScrollPos().scrollTop,e=BX.pos(this.container).bottom;t+window.innerHeight>e&&this.showMore()},showMore:function(){if(this.navParams.NavPageNomer<this.navParams.NavPageCount){var t={action:"showMore"};t["PAGEN_"+this.navParams.NavNum]=this.navParams.NavPageNomer+1,this.formPosting||(this.formPosting=!0,this.disableButton(),this.sendRequest(t))}},bigDataLoad:function(){var t="https://analytics.bitrix.info/crecoms/v1_0/recoms.php",e=BX.ajax.prepareData(this.bigData.params);e&&(t+=(-1!==t.indexOf("?")?"&":"?")+e);var a=BX.delegate(function(t){this.sendRequest({action:"deferredLoad",bigData:"Y",items:t&&t.items||[],rid:t&&t.id,count:this.bigData.count,rowsRange:this.bigData.rowsRange,shownIds:this.bigData.shownIds})},this);BX.ajax({method:"GET",dataType:"json",url:t,timeout:3,onsuccess:a,onfailure:a})},deferredLoad:function(){this.sendRequest({action:"deferredLoad"})},sendRequest:function(t){var e={siteId:this.siteId,template:this.template,parameters:this.parameters};this.ajaxId&&(e.AJAX_ID=this.ajaxId),BX.ajax({url:this.componentPath+"/ajax.php"+(-1!==document.location.href.indexOf("clear_cache=Y")?"?clear_cache=Y":""),method:"POST",dataType:"json",timeout:60,data:BX.merge(e,t),onsuccess:BX.delegate(function(e){e&&e.JS&&BX.ajax.processScripts(BX.processHTML(e.JS).SCRIPT,!1,BX.delegate(function(){this.showAction(e,t)},this))},this)})},showAction:function(t,e){if(e)switch(e.action){case"showMore":this.processShowMoreAction(t);break;case"deferredLoad":this.processDeferredLoadAction(t,"Y"===e.bigData)}},processShowMoreAction:function(t){this.formPosting=!1,this.enableButton(),t&&(this.navParams.NavPageNomer++,this.processItems(t.items,t.imgLazyLoad,t.imgWebp),this.processPagination(t.pagination),this.processEpilogue(t.epilogue),this.checkButton())},processDeferredLoadAction:function(t,e){if(t){var a=e?this.bigData.rows:{};this.processItems(t.items,t.imgLazyLoad,t.imgWebp,BX.util.array_keys(a))}},processItems:function(t,e,a,o){if(t){var i,s,n=BX.processHTML(t,!1),r=BX.create("DIV"),h={};if(r.innerHTML=n.HTML,(i=r.querySelectorAll('[data-entity="item-col"]')).length){for(var c in this.showHeader(!0),i)if(i.hasOwnProperty(c)){if(s=!!o&&this.container.querySelectorAll('[data-entity="item-col"]'),a){var d=i[c].querySelectorAll("img");if(d)for(var u in d)if(d.hasOwnProperty(u)){var m=d[u].getAttribute("data-lazyload-src"),l=d[u].getAttribute("src");m&&"http"!==m.substr(0,4)&&"data:image/"!==m.substr(0,11)&&-1==m.indexOf(".webp")?h[m]=m:l&&"http"!==l.substr(0,4)&&"data:image/"!==l.substr(0,11)&&-1==l.indexOf(".webp")&&(h[l]=l)}}i[c].style.opacity=0,s&&BX.type.isDomNode(s[o[c]])?s[o[c]].parentNode.insertBefore(i[c],s[o[c]]):this.container.appendChild(i[c])}a&&Object.keys(h).length>0&&convertImgToWebp(h),e&&imgLazyLoad(),new BX.easing({duration:2e3,start:{opacity:0},finish:{opacity:100},transition:BX.easing.makeEaseOut(BX.easing.transitions.quad),step:function(t){for(var e in i)i.hasOwnProperty(e)&&(i[e].style.opacity=t.opacity/100)},complete:function(){for(var t in i)i.hasOwnProperty(t)&&i[t].removeAttribute("style")}}).animate()}BX.ajax.processScripts(n.SCRIPT)}},processPagination:function(t){if(t){var e=document.querySelectorAll('[data-pagination-num="'+this.navParams.NavNum+'"]');for(var a in e)e.hasOwnProperty(a)&&(e[a].innerHTML=t)}},processEpilogue:function(t){if(t){var e=BX.processHTML(t,!1);BX.ajax.processScripts(e.SCRIPT)}},showHeader:function(t){var e=BX.findParent(this.container,{attr:{"data-entity":"parent-container"}});if(e){e.removeAttribute("style");var a=e.querySelector('[data-entity="header"]');a&&"true"!=a.getAttribute("data-showed")&&(t?(a.style.display="",new BX.easing({duration:2e3,start:{opacity:0},finish:{opacity:100},transition:BX.easing.makeEaseOut(BX.easing.transitions.quad),step:function(t){a.style.opacity=t.opacity/100},complete:function(){a.removeAttribute("style"),a.setAttribute("data-showed","true")}}).animate()):(a.removeAttribute("style"),a.setAttribute("data-showed","true")))}}})}();