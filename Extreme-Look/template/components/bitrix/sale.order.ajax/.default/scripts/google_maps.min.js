BX.namespace("BX.Sale.OrderAjaxComponent.Maps"),function(){"use strict";BX.Sale.OrderAjaxComponent.Maps={init:function(t){return this.context=t||{},this.pickUpOptions=this.context.options.pickUpMap,this.propsOptions=this.context.options.propertyMap,this.maxWaitTimeExpired=!1,this.templateFolder=this.context.templateFolder,this.icons={default:this.templateFolder+"/images/marker-icon.png",active:this.templateFolder+"/images/marker-icon-active.png"},this.defaultStoreLogo=this.context.defaultStoreLogo,this},initializePickUpMap:function(t){if(google){this.markers=[],this.bounds=new google.maps.LatLngBounds;var e=t?parseFloat(BX.util.trim(t.GPS_N)):this.pickUpOptions.defaultMapPosition.lat,s=t?parseFloat(BX.util.trim(t.GPS_S)):this.pickUpOptions.defaultMapPosition.lon;this.pickUpMap=new google.maps.Map(BX("pickUpMap"),{center:{lat:e,lng:s},zoom:this.pickUpOptions.defaultMapPosition.zoom,scrollwheel:!1}),google.maps.event.addListener(this.pickUpMap,"click",BX.proxy(this.closeAllBalloons,this))}},canUseRecommendList:function(){return!1},getRecommendedStoreIds:function(t,e){return[]},getDistance:function(t,e){return!1},pickUpMapFocusWaiter:function(){this.pickUpMap&&this.markers.length?this.setPickUpMapFocus():setTimeout(BX.proxy(this.pickUpMapFocusWaiter,this),100)},setPickUpMapFocus:function(){google.maps.event.trigger(this.pickUpMap,"resize"),this.pickUpMap.fitBounds(this.bounds)},showNearestPickups:function(t,e){},buildBalloons:function(t){if(google){var e,s,i,o,a=this;for(e=0;e<t.length;e++)s=new google.maps.Marker({position:{lat:parseFloat(t[e].GPS_N),lng:parseFloat(t[e].GPS_S)},map:this.pickUpMap,title:t[e].TITLE}),o=(i=a.context.getImageSources(t[e],"IMAGE_ID"))&&i.src_1x||a.defaultStoreLogo,s.info=new InfoBubble({content:'<div class="pickup-item-marker"><div class="pickup-item-marker-image"><img src="'+o+'" /></div><div class="pickup-item-marker-caption"><div class="pickup-item-marker-title">'+BX.util.htmlspecialchars(t[e].TITLE)+"</div>"+this.getStoreInfoHtml(t[e])+'<a class="pickup-item-marker-link" href="javascript:void(0)" data-store="'+t[e].ID+'">'+this.context.params.MESS_SELECT_PICKUP+"</a></div>",shadowStyle:0,padding:0,borderRadius:5,arrowSize:0,borderWidth:0}),s.storeId=t[e].ID,google.maps.event.addListener(s.info,"domready",function(){var t=document.querySelector("a[data-store]");t&&BX.bind(t,"click",BX.proxy(a.selectStoreByClick,a))}),google.maps.event.addListener(s,"click",function(){a.closeAllBalloons(),this.info.open(this.getMap(),this)}),BX("BUYER_STORE").value===t[e].ID?s.setIcon(this.icons.active):s.setIcon(this.icons.default),this.markers.push(s),this.bounds.extend(s.getPosition())}},selectStoreByClick:function(t){var e=t.target||t.srcElement;this.context.selectStore(e.getAttribute("data-store")),this.context.clickNextAction(t),this.closeAllBalloons()},closeAllBalloons:function(){for(var t=0;t<this.markers.length;t++)this.markers[t].info.close()},selectBalloon:function(t){if(this.pickUpMap&&this.markers&&this.markers.length)for(var e=0;e<this.markers.length;e++)this.markers[e].storeId===t?(this.markers[e].setIcon(this.icons.active),this.pickUpMap.panTo(this.markers[e].getPosition())):this.markers[e].setIcon(this.icons.default)},pickUpFinalAction:function(){},initializePropsMap:function(t){google&&(this.propsMap=new google.maps.Map(BX("propsMap"),{center:{lat:t.lat,lng:t.lon},zoom:t.zoom,scrollwheel:!1}),this.currentPropsMapCenter=this.propsMap.getCenter(),google.maps.event.addListener(this.propsMap,"click",BX.delegate(function(t){this.propsMarker?this.propsMarker.setPosition(t.latLng):(this.propsMarker=new google.maps.Marker({position:t.latLng,map:this.propsMap,draggable:!0}),this.propsMarker.addListener("drag",BX.proxy(this.onPropsMarkerChanged,this)),this.propsMarker.addListener("dragend",BX.proxy(this.onPropsMarkerChanged,this))),this.currentPropsMapCenter=t.latLng,this.onPropsMarkerChanged({latLng:t.latLng})},this)))},onPropsMarkerChanged:function(t){var e,s,i,o,a=BX("orderDescription",!0),r=t.latLng.lat(),n=t.latLng.lng();a&&(-1===(e=a.value.indexOf(BX.message("SOA_MAP_COORDS")+":"))?a.value=BX.message("SOA_MAP_COORDS")+": "+r+", "+n+"\r\n"+a.value:(o=BX.message("SOA_MAP_COORDS")+": "+r+", "+n,s=a.value.substring(0,e),i=a.value.substring(e+o.length),a.value=s+o+i))},propsMapFocusWaiter:function(){this.propsMap?this.setPropsMapFocus():setTimeout(BX.proxy(this.propsMapFocusWaiter,this),100)},setPropsMapFocus:function(){google.maps.event.trigger(this.propsMap,"resize"),this.propsMap.setCenter(this.currentPropsMapCenter)},getStoreInfoHtml:function(t){var e="";return t.ADDRESS&&(e+='<div class="pickup-item-marker-address"><i class="icon-map-marker"></i><span>'+BX.util.htmlspecialchars(t.ADDRESS)+"</span></div>"),e}}}();