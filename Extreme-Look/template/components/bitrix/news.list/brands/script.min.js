!function(t){"use strict";t.JCNewsListBrandsComponent||(t.JCNewsListBrandsComponent=function(t){this.formPosting=!1,this.siteId=t.siteId||"",this.template=t.template||"",this.templatePath=t.templatePath||"",this.parameters=t.parameters||"",t.navParams&&(this.navParams={NavNum:t.navParams.NavNum||1,NavPageNomer:parseInt(t.navParams.NavPageNomer)||1,NavPageCount:parseInt(t.navParams.NavPageCount)||1}),this.container=document.querySelector("[data-entity='container-"+this.navParams.NavNum+"']"),this.showMoreButton=null,this.showMoreButtonMessage=null,this.showMoreButtonContainer=null,t.lazyLoad&&(this.showMoreButton=document.querySelector('[data-use="show-more-'+this.navParams.NavNum+'"]'),this.showMoreButtonMessage=this.showMoreButton.innerHTML,this.showMoreButtonContainer=document.querySelector('[data-entity="brands-show-more-container"]'),BX.bind(this.showMoreButton,"click",BX.proxy(this.showMore,this))),this.countriesLinks=document.body.querySelector(".brands-countries-links"),this.countriesLinks&&BX.ready(BX.delegate(this.initCountriesLinks,this))},t.JCNewsListBrandsComponent.prototype={checkButton:function(){this.showMoreButton&&(this.navParams.NavPageNomer==this.navParams.NavPageCount?BX.remove(this.showMoreButtonContainer):this.container.appendChild(this.showMoreButtonContainer))},enableButton:function(){this.showMoreButton&&(BX.removeClass(this.showMoreButton,"disabled"),this.showMoreButton.innerHTML=this.showMoreButtonMessage)},disableButton:function(){this.showMoreButton&&(BX.addClass(this.showMoreButton,"disabled"),this.showMoreButton.innerHTML=BX.message("BRANDS_LOADING"))},showMore:function(){if(this.navParams.NavPageNomer<this.navParams.NavPageCount){var e={action:"showMoreBrands"};e.requestUri=t.location.pathname,e["PAGEN_"+this.navParams.NavNum]=this.navParams.NavPageNomer+1,this.formPosting||(this.formPosting=!0,this.disableButton(),this.sendRequest(e))}},sendRequest:function(t){var e={siteId:this.siteId,template:this.template,parameters:this.parameters},a=!!this.countriesLinks&&this.countriesLinks.querySelectorAll(".brands-country-link");if(a)for(var s in a)a.hasOwnProperty(s)&&BX.type.isDomNode(a[s])&&BX.hasClass(a[s],"active")&&(e.countryId=a[s].getAttribute("data-country-id"));BX.ajax({url:this.templatePath+"/ajax.php"+(-1!==document.location.href.indexOf("clear_cache=Y")?"?clear_cache=Y":""),method:"POST",dataType:"json",timeout:60,data:BX.merge(e,t),onsuccess:BX.delegate(function(t){t&&t.JS&&BX.ajax.processScripts(BX.processHTML(t.JS).SCRIPT,!1,BX.delegate(function(){this.processShowMoreAction(t)},this))},this)})},processShowMoreAction:function(t){this.formPosting=!1,this.enableButton(),t&&(this.navParams.NavPageNomer++,this.processItems(t.items,t.imgLazyLoad,t.imgWebp),this.processPagination(t.pagination),this.checkButton())},processItems:function(t,e,a){if(t){var s,i=BX.processHTML(t,!1),n=BX.create("DIV"),o={};if(n.innerHTML=i.HTML,(s=n.querySelectorAll('[data-entity="item"]')).length){for(var r in s)if(s.hasOwnProperty(r)){if(a){var h=s[r].querySelectorAll("img");if(h)for(var c in h)if(h.hasOwnProperty(c)){var u=h[c].getAttribute("data-lazyload-src"),p=h[c].getAttribute("src");u&&"http"!==u.substr(0,4)&&"data:image/"!==u.substr(0,11)&&-1==u.indexOf(".webp")?o[u]=u:p&&"http"!==p.substr(0,4)&&"data:image/"!==p.substr(0,11)&&-1==p.indexOf(".webp")&&(o[p]=p)}}s[r].style.opacity=0,this.container.appendChild(s[r])}a&&Object.keys(o).length>0&&convertImgToWebp(o),e&&imgLazyLoad(),new BX.easing({duration:2e3,start:{opacity:0},finish:{opacity:100},transition:BX.easing.makeEaseOut(BX.easing.transitions.quad),step:function(t){for(var e in s)s.hasOwnProperty(e)&&(s[e].style.opacity=t.opacity/100)},complete:function(){for(var t in s)s.hasOwnProperty(t)&&s[t].removeAttribute("style")}}).animate()}BX.ajax.processScripts(i.SCRIPT)}},processPagination:function(t){if(t){var e=document.querySelector('[data-pagination-num="'+this.navParams.NavNum+'"]');e&&(e.innerHTML=t)}},initCountriesLinks:function(){var t=this.countriesLinks.querySelectorAll(".brands-country-link"),e=!1;if(t)for(var a in t)t.hasOwnProperty(a)&&BX.type.isDomNode(t[a])&&(BX.bind(t[a],"click",BX.proxy(this.changeCountryLink,this)),e?BX.removeClass(t[a],"active"):(BX.addClass(t[a],"active"),e=!0))},changeCountryLink:function(e){BX.PreventDefault(e);var a=BX.proxy_context&&BX.proxy_context.getAttribute("data-country-id");if(!BX.hasClass(BX.proxy_context,"active")&&a){var s=document.body.querySelector(".brands-items-container");s&&(s.style.opacity=.2,BX.ajax({url:this.templatePath+"/ajax.php"+(-1!==document.location.href.indexOf("clear_cache=Y")?"?clear_cache=Y":""),method:"POST",dataType:"json",timeout:60,data:{action:"changeCountryLink",requestUri:t.location.pathname,siteId:this.siteId,template:this.template,parameters:this.parameters,countryId:a},onsuccess:BX.delegate(function(t){t&&t.JS&&BX.ajax.processScripts(BX.processHTML(t.JS).SCRIPT,!1,BX.delegate(function(){if(BX.cleanNode(s),t.items){var e=BX.processHTML(t.items,!1);(p=BX.create("DIV")).innerHTML=e.HTML;var i=p.querySelector(".brands-items");if(i){if(t.imgWebp){var n={},o=i.querySelectorAll("img");if(o)for(var r in o)if(o.hasOwnProperty(r)){var h=o[r].getAttribute("data-lazyload-src"),c=o[r].getAttribute("src");h&&"http"!==h.substr(0,4)&&"data:image/"!==h.substr(0,11)&&-1==h.indexOf(".webp")?n[h]=h:c&&"http"!==c.substr(0,4)&&"data:image/"!==c.substr(0,11)&&-1==c.indexOf(".webp")&&(n[c]=c)}Object.keys(n).length>0&&convertImgToWebp(n)}s.appendChild(i),t.imgLazyLoad&&imgLazyLoad(),this.container=i}BX.ajax.processScripts(e.SCRIPT)}if(t.showMore){(p=BX.create("DIV")).innerHTML=t.showMore;var u=p.querySelector(".brands-more");u&&(s.appendChild(u),this.showMoreButtonContainer=u,this.showMoreButton=u.querySelector(".btn-more"),this.showMoreButtonMessage=this.showMoreButton.innerHTML,BX.bind(this.showMoreButton,"click",BX.proxy(this.showMore,this)))}if(t.pagination){var p;(p=BX.create("DIV")).innerHTML=t.pagination;var m=p.querySelector(".brands-pagination");m&&(0==a&&s.appendChild(m),this.navParams={NavNum:m.getAttribute("data-pagination-num"),NavPageNomer:parseInt(m.getAttribute("data-pagination-page-nomer")),NavPageCount:parseInt(m.getAttribute("data-pagination-page-count"))})}new BX.easing({duration:2e3,start:{opacity:20},finish:{opacity:100},transition:BX.easing.makeEaseOut(BX.easing.transitions.quad),step:function(t){s.style.opacity=t.opacity/100},complete:function(){s.removeAttribute("style")}}).animate()},this))},this)}));var i=this.countriesLinks.querySelectorAll(".brands-country-link");if(i)for(var n in i)i.hasOwnProperty(n)&&BX.type.isDomNode(i[n])&&(i[n].getAttribute("data-country-id")===a?BX.addClass(i[n],"active"):BX.removeClass(i[n],"active"))}}})}(window);